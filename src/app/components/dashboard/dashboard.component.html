<div class="dashboard-container">
  <!-- ==================== HEADER CON FILTROS ==================== -->
  <div class="dashboard-header">
    <div class="header-top">
      <div class="header-left">
        <h1 class="dashboard-title">
          <img src="assets/dashboard.png" alt="Dashboard" class="title-icon" />
          Dashboard - GestiÃ³n de Planillas
        </h1>
        <p class="dashboard-subtitle">
          <span class="subtitle-dots">
            <span class="subtitle-dot subtitle-dot--1"></span>
            <span class="subtitle-dot subtitle-dot--2"></span>
            <span class="subtitle-dot subtitle-dot--3"></span>
          </span>
          Vista completa y anÃ¡lisis en tiempo real
        </p>
      </div>
      <div class="header-right">
      <button
        class="btn btn--icon filter-toggle-btn"
        (click)="toggleFiltrosPanel()"
        [class.is-active]="mostrarFiltrosPanel"
        [attr.aria-expanded]="mostrarFiltrosPanel"
        aria-controls="dashboard-filtros"
      >
        <span class="icon">{{ mostrarFiltrosPanel ? 'ğŸ—‚ï¸' : 'ğŸ›ï¸' }}</span>
        {{ mostrarFiltrosPanel ? 'Ocultar filtros' : 'Filtros' }}
      </button>
        <button class="btn btn--icon" (click)="cargarDatos()" [disabled]="cargando">
          <span class="icon">ğŸ”„</span>
          {{ cargando ? 'Actualizando...' : 'Actualizar' }}
        </button>
        <button class="btn btn--primary" (click)="exportarDatos()">
          <span class="icon">ğŸ“¥</span>
          Exportar
        </button>
      </div>
    </div>

    <!-- FILTROS AVANZADOS -->
    <div
      class="filtros-panel"
      *ngIf="mostrarFiltrosPanel"
      id="dashboard-filtros"
    >
      <div class="filtros-header">
        <h3 class="filtros-titulo">ğŸ” Filtros de BÃºsqueda</h3>
        <div class="filtros-acciones">
          <button class="btn btn--sm btn--outline" (click)="limpiarFiltros()">
            â†©ï¸ Limpiar
          </button>
          <button class="btn btn--sm btn--success" (click)="aplicarFiltros()">
            âœ“ Aplicar
          </button>
        </div>
      </div>
      
      <div class="filtros-grid">
        <div class="filtro-group">
          <label class="filtro-label">ğŸ“… Fecha Inicio</label>
          <input 
            type="date" 
            class="filtro-input" 
            [(ngModel)]="filtros.fechaInicio"
          />
        </div>

        <div class="filtro-group">
          <label class="filtro-label">ğŸ“… Fecha Fin</label>
          <input 
            type="date" 
            class="filtro-input" 
            [(ngModel)]="filtros.fechaFin"
          />
        </div>

        <div class="filtro-group">
          <label class="filtro-label">ğŸ¢ Ãrea</label>
          <select class="filtro-select" [(ngModel)]="filtros.area">
            <option *ngFor="let area of areas" [value]="area.toLowerCase()">
              {{ area }}
            </option>
          </select>
        </div>

        <div class="filtro-group">
          <label class="filtro-label">ğŸ“„ Tipo de Contrato</label>
          <select class="filtro-select" [(ngModel)]="filtros.tipoContrato">
            <option *ngFor="let tipo of tiposContrato" [value]="tipo.toLowerCase()">
              {{ tipo }}
            </option>
          </select>
        </div>

        <div class="filtro-group">
          <label class="filtro-label">âœ… Estado</label>
          <select class="filtro-select" [(ngModel)]="filtros.estado">
            <option *ngFor="let estado of estados" [value]="estado.toLowerCase()">
              {{ estado }}
            </option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== ALERTAS IMPORTANTES ==================== -->
  <div class="alertas-container" *ngIf="alertas.length > 0">
    <div 
      *ngFor="let alerta of alertas" 
      class="alerta-card"
      [class.alerta--warning]="alerta.tipo === 'warning'"
      [class.alerta--error]="alerta.tipo === 'error'"
      [class.alerta--info]="alerta.tipo === 'info'"
      [class.alerta--success]="alerta.tipo === 'success'"
    >
      <div class="alerta-icon">
        <span *ngIf="alerta.tipo === 'warning'">âš ï¸</span>
        <span *ngIf="alerta.tipo === 'error'">ğŸš¨</span>
        <span *ngIf="alerta.tipo === 'info'">â„¹ï¸</span>
        <span *ngIf="alerta.tipo === 'success'">âœ…</span>
      </div>
      <div class="alerta-content">
        <h4 class="alerta-titulo">{{ alerta.titulo }}</h4>
        <p class="alerta-mensaje">{{ alerta.mensaje }}</p>
      </div>
      <button class="alerta-close">Ã—</button>
    </div>
  </div>

  <!-- ==================== CALENDARIO DE EVENTOS ==================== -->
  <div class="eventos-container">
    <div class="eventos-header">
      <h3 class="eventos-titulo">ğŸ“… Eventos y Fechas Importantes</h3>
      <button class="btn btn--sm btn--outline" (click)="abrirCalendarioCompleto()">Ver calendario completo</button>
    </div>
    <div class="eventos-grid">
      <div 
        *ngFor="let evento of eventosProximos"
        class="evento-card"
        [class.evento--planilla]="evento.tipo === 'planilla'"
        [class.evento--beneficio]="evento.tipo === 'beneficio'"
        [class.evento--vencimiento]="evento.tipo === 'vencimiento'"
        [class.evento--reunion]="evento.tipo === 'reunion'"
      >
        <div class="evento-fecha">
          <span class="fecha-dia">{{ evento.fecha.getDate() }}</span>
          <span class="fecha-mes">{{ obtenerMes(evento.fecha) }}</span>
        </div>
        <div class="evento-info">
          <h4 class="evento-titulo">{{ evento.titulo }}</h4>
          <p class="evento-descripcion">{{ evento.descripcion }}</p>
          <span class="evento-dias" [class.evento-dias--sin-reunion]="evento.tipo === 'reunion' && diasHasta(evento.fecha) < 0">
            {{ obtenerTextoDias(evento) }}
          </span>
        </div>
        <div class="evento-icono">
          <span *ngIf="evento.tipo === 'planilla'">ğŸ’°</span>
          <span *ngIf="evento.tipo === 'beneficio'">ğŸ</span>
          <span *ngIf="evento.tipo === 'vencimiento'">â°</span>
          <span *ngIf="evento.tipo === 'reunion'">ğŸ‘¥</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== INDICADORES CLAVE DE RENDIMIENTO ==================== -->
  <div class="indicadores-container">
    <div class="indicadores-header">
      <div class="indicadores-header-left">
        <h3 class="indicadores-titulo">
          <span class="indicadores-icon">ğŸ“Š</span>
          Indicadores Clave de Rendimiento
        </h3>
        <p class="indicadores-subtitulo">MÃ©tricas Principales del Sistema en Tiempo Real</p>
      </div>
    </div>
    <div class="kpis-grid">
    <div 
      *ngFor="let kpi of kpis" 
      class="kpi-card"
      [style.border-color]="kpi.color"
    >
      <div class="kpi-header">
        <span class="kpi-icon">{{ kpi.icono }}</span>
        <span 
          class="kpi-badge"
          [class.badge--up]="kpi.tendencia === 'up'"
          [class.badge--down]="kpi.tendencia === 'down'"
        >
          <span *ngIf="kpi.tendencia === 'up'">â†—</span>
          <span *ngIf="kpi.tendencia === 'down'">â†˜</span>
          <span *ngIf="kpi.tendencia === 'neutral'">â†’</span>
          {{ kpi.porcentaje > 0 ? kpi.porcentaje + '%' : '' }}
        </span>
      </div>
      <div class="kpi-body">
        <h3 class="kpi-titulo">{{ kpi.titulo }}</h3>
        <p class="kpi-valor" [style.color]="kpi.color">{{ kpi.valor }}</p>
      </div>
      <div class="kpi-footer">
        <button class="kpi-link" (click)="verDetalle('kpi', kpi.titulo)">
          Ver detalle â†’
        </button>
      </div>
    </div>
  </div>
  </div>

  <!-- ==================== TABLAS Y LISTAS ==================== -->
  <div class="tablas-container">
    <div class="tablas-header">
      <div class="tablas-header-left">
        <h3 class="tablas-titulo">
          <span class="tablas-icon">ğŸ“‹</span>
          InformaciÃ³n Detallada
        </h3>
        <p class="tablas-subtitulo">Movimientos de planilla y ranking de trabajadores</p>
      </div>
    </div>
    <div class="tablas-grid">
      <!-- TABLA: Ãšltimos movimientos -->
      <div class="tabla-card">
        <div class="tabla-header">
          <h3 class="tabla-titulo">ğŸ’³ Ãšltimos Movimientos de Planilla</h3>
          <span class="tabla-badge">{{ mesActual }}</span>
        </div>
        <div class="tabla-body">
          <div class="tabla-scroll">
            <table class="tabla">
              <thead>
                <tr>
                  <th>Tipo</th>
                  <th>DescripciÃ³n</th>
                  <th>Fecha</th>
                  <th>Monto</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let mov of movimientos" (click)="verDetalle('movimiento', mov.id)">
                  <td>
                    <span class="cell-icon">
                      <span *ngIf="mov.tipo.includes('Pago')">ğŸ’°</span>
                      <span *ngIf="mov.tipo.includes('CTS')">ğŸ¦</span>
                      <span *ngIf="mov.tipo.includes('GratificaciÃ³n')">ğŸ</span>
                    </span>
                    {{ mov.tipo }}
                  </td>
                  <td>{{ mov.descripcion }}</td>
                  <td>{{ formatearFecha(mov.fecha) }}</td>
                  <td class="cell-monto">
                    <strong>{{ mov.monto ? formatearMoneda(mov.monto) : '-' }}</strong>
                  </td>
                  <td>
                    <span 
                      class="estado-badge"
                      [class.estado--completado]="mov.estado === 'completado'"
                      [class.estado--pendiente]="mov.estado === 'pendiente'"
                      [class.estado--proceso]="mov.estado === 'proceso'"
                    >
                      {{ mov.estado }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- TOP 5 TRABAJADORES -->
      <div class="tabla-card">
        <div class="tabla-header">
          <h3 class="tabla-titulo">ğŸ† Top 5 Trabajadores por Salario</h3>
          <button class="btn btn--sm btn--outline">Ver todos</button>
        </div>
      <div class="tabla-body">
        <div class="trabajadores-list">
          <div 
            *ngFor="let trabajador of topTrabajadores; let i = index"
            class="trabajador-item"
            (click)="verDetalle('trabajador', trabajador.id)"
          >
            <div class="trabajador-rank">{{ i + 1 }}</div>
            <div class="trabajador-avatar">{{ trabajador.foto }}</div>
            <div class="trabajador-info">
              <h4 class="trabajador-nombre">{{ trabajador.nombre }}</h4>
              <p class="trabajador-cargo">{{ trabajador.cargo }} Â· {{ trabajador.area }}</p>
            </div>
            <div class="trabajador-salario">
              <strong>{{ formatearMoneda(trabajador.salario) }}</strong>
              <span>mensual</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>

  <!-- ==================== GRÃFICOS PRINCIPALES ==================== -->
  <div class="graficos-container">
    <div class="graficos-header">
      <div class="graficos-header-left">
        <h3 class="graficos-titulo">
          <span class="graficos-icon">ğŸ“Š</span>
          AnÃ¡lisis y VisualizaciÃ³n de Datos
        </h3>
        <p class="graficos-subtitulo">GrÃ¡ficos y estadÃ­sticas en tiempo real del sistema</p>
      </div>
    </div>
    <div class="graficos-grid">
    <!-- GRÃFICO: EvoluciÃ³n de planilla mensual -->
    <div class="grafico-card grafico-card--planilla">
      <div class="grafico-header">
        <div class="grafico-header-left">
          <span class="grafico-icon">ğŸ“ˆ</span>
          <h3 class="grafico-titulo">EvoluciÃ³n de Planilla Mensual</h3>
        </div>
        <div class="grafico-header-actions">
          <button 
            class="btn-icon btn-icon--export" 
            (click)="exportarGrafico()"
            title="Exportar grÃ¡fico"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
          </button>
          <button 
            class="btn-icon btn-icon--config" 
            (click)="abrirModalConfigGrafico()"
            title="Configurar grÃ¡fico"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3m15.364 6.364l-4.243-4.243m-4.242 0L5.636 17.364m12.728 0l-4.243-4.243m-4.242 0L5.636 6.636"></path>
            </svg>
          </button>
        </div>
      </div>
      <div class="grafico-body">
        <div class="chart-container chart-container--planilla">
          <canvas #planillaChartCanvas></canvas>
        </div>
      </div>
    </div>

    <!-- GRÃFICO: DistribuciÃ³n por RÃ©gimen Laboral -->
    <div class="grafico-card grafico-card--regimen">
      <div class="grafico-header">
        <div class="grafico-header-left">
          <span class="grafico-icon">ğŸ’¼</span>
          <h3 class="grafico-titulo">DistribuciÃ³n por RÃ©gimen Laboral</h3>
        </div>
        <div class="grafico-header-actions">
          <button 
            class="btn-icon btn-icon--export" 
            (click)="exportarGraficoRegimen()"
            title="Exportar grÃ¡fico"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
          </button>
          <button 
            class="btn-icon btn-icon--config" 
            (click)="abrirModalConfigGraficoRegimen()"
            title="Configurar grÃ¡fico"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3m15.364 6.364l-4.243-4.243m-4.242 0L5.636 17.364m12.728 0l-4.243-4.243m-4.242 0L5.636 6.636"></path>
            </svg>
          </button>
        </div>
      </div>
      <div class="grafico-body">
        <div class="chart-container chart-container--regimen">
          <canvas #regimenChartCanvas></canvas>
        </div>
      </div>
    </div>

    <!-- GRÃFICO: Estado de contratos -->
    <div class="grafico-card">
      <div class="grafico-header">
        <h3 class="grafico-titulo">ğŸ“Š Estado de Contratos</h3>
        <button class="btn btn--sm btn--ghost">âš™ï¸</button>
      </div>
      <div class="grafico-body">
        <div class="chart-container">
          <div class="chart-donut">
            <div class="donut-legend">
              <div 
                *ngFor="let label of datosContratos.labels; let i = index"
                class="legend-item"
              >
                <span class="legend-color" [style.background-color]="obtenerColor(i)"></span>
                <span class="legend-label">{{ label }}</span>
                <span class="legend-value">{{ datosContratos.valores[i] }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- GRÃFICO: Asistencia Semanal - ELIMINADO -->
    <!-- La grÃ¡fica de asistencia ha sido eliminada para evitar cÃ¡lculos innecesarios que causan freeze -->
  </div>

  <!-- LOADING OVERLAY -->
  <div class="loading-overlay" *ngIf="cargando">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>Cargando datos del dashboard...</p>
    </div>
  </div>
</div>

<!-- MODAL: ConfiguraciÃ³n del GrÃ¡fico de RÃ©gimen Laboral -->
<div class="modal-overlay" *ngIf="mostrarModalConfigGraficoRegimen" (click)="cerrarModalConfigGraficoRegimen()" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 9999;">
  <div class="modal-content modal-config-grafico" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">
        <span class="modal-icon">âš™ï¸</span>
        Configurar GrÃ¡fico de RÃ©gimen Laboral
      </h3>
      <button class="modal-close" (click)="cerrarModalConfigGraficoRegimen()">Ã—</button>
    </div>
    
    <div class="modal-body">
      <div class="config-section">
        <p class="config-info" style="color: var(--text-2); line-height: 1.6; margin: 0;">
          El grÃ¡fico de barras muestra la distribuciÃ³n de trabajadores por rÃ©gimen laboral.
          Los datos se actualizan automÃ¡ticamente desde el sistema.
        </p>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn--secondary" (click)="cerrarModalConfigGraficoRegimen()">
        Cerrar
      </button>
      <button class="btn btn--primary" (click)="aplicarConfiguracionGraficoRegimen()">
        Actualizar GrÃ¡fico
      </button>
    </div>
  </div>
</div>

<!-- MODAL: ConfiguraciÃ³n del GrÃ¡fico de Asistencia Semanal - ELIMINADO -->
<!-- El modal y toda la grÃ¡fica de asistencia han sido eliminados para evitar cÃ¡lculos innecesarios -->

  <!-- MODAL DETALLE KPI -->
  <div class="modal-overlay" *ngIf="mostrarModalDetalleKPI" (click)="cerrarModalDetalleKPI()">
    <div class="modal-content modal-detalle-asistencia" (click)="$event.stopPropagation()" *ngIf="detalleKPISeleccionado?.esAsistenciaHoy; else modalKpiNormal">
      <!-- MODAL ESPECIAL PARA ASISTENCIA HOY -->
      <div class="modal-header">
        <div class="modal-header-content">
          <div class="modal-icon">ğŸ“…</div>
          <div>
            <h2 class="modal-title">Detalle de Asistencia de Hoy</h2>
            <p class="modal-subtitle" *ngIf="detalleAsistenciaHoy">
              {{ detalleAsistenciaHoy.fecha }} â€¢ {{ detalleAsistenciaHoy.porcentaje }}
            </p>
          </div>
        </div>
        <button class="modal-close" (click)="cerrarModalDetalleKPI()">Ã—</button>
      </div>
      
      <div class="modal-body modal-body-asistencia">
        <!-- LOADING -->
        <div class="loading-detalle" *ngIf="cargandoDetalleAsistencia">
          <div class="spinner-small"></div>
          <p>Cargando detalle de asistencia...</p>
        </div>

        <!-- RESUMEN -->
        <div class="resumen-asistencia" *ngIf="detalleAsistenciaHoy && !cargandoDetalleAsistencia">
          <div class="resumen-card resumen-card--total">
            <div class="resumen-icon">ğŸ‘¥</div>
            <div class="resumen-info">
              <div class="resumen-label">Total Trabajadores</div>
              <div class="resumen-value">{{ detalleAsistenciaHoy.totalTrabajadores }}</div>
            </div>
          </div>
          <div class="resumen-card resumen-card--presente">
            <div class="resumen-icon">âœ…</div>
            <div class="resumen-info">
              <div class="resumen-label">Con Asistencia</div>
              <div class="resumen-value">{{ detalleAsistenciaHoy.conAsistencia }}</div>
            </div>
          </div>
          <div class="resumen-card resumen-card--falta">
            <div class="resumen-icon">âŒ</div>
            <div class="resumen-info">
              <div class="resumen-label">Sin Asistencia</div>
              <div class="resumen-value">{{ detalleAsistenciaHoy.sinAsistencia }}</div>
            </div>
          </div>
        </div>

        <!-- LISTA DE TRABAJADORES -->
        <div class="lista-trabajadores" *ngIf="detalleAsistenciaHoy && !cargandoDetalleAsistencia && detalleAsistenciaHoy.trabajadores && detalleAsistenciaHoy.trabajadores.length > 0">
          <div class="trabajador-item" 
               *ngFor="let trabajador of detalleAsistenciaHoy.trabajadores"
               [class.trabajador--presente]="trabajador.tieneAsistencia"
               [class.trabajador--falta]="!trabajador.tieneAsistencia">
            <div class="trabajador-status">
              <span class="status-icon" *ngIf="trabajador.tieneAsistencia">âœ…</span>
              <span class="status-icon" *ngIf="!trabajador.tieneAsistencia">âŒ</span>
            </div>
            <div class="trabajador-info">
              <div class="trabajador-nombre">{{ trabajador.nombreCompleto }}</div>
              <div class="trabajador-detalle">
                <span class="trabajador-dni">DNI: {{ trabajador.dni }}</span>
                <span class="trabajador-separador">â€¢</span>
                <span class="trabajador-cargo">{{ trabajador.cargo }}</span>
                <span class="trabajador-separador">â€¢</span>
                <span class="trabajador-area">{{ trabajador.area }}</span>
              </div>
            </div>
            <div class="trabajador-horarios" *ngIf="trabajador.tieneAsistencia">
              <!-- HORARIOS MAÃ‘ANA -->
              <div class="horario-turno" *ngIf="trabajador.horaEntradaManana || trabajador.horaSalidaManana">
                <div class="horario-turno-label">ğŸŒ… MaÃ±ana</div>
                <div class="horario-turno-items">
                  <div class="horario-item" *ngIf="trabajador.horaEntradaManana">
                    <span class="horario-label">Entrada:</span>
                    <span class="horario-value">{{ trabajador.horaEntradaManana }}</span>
                  </div>
                  <div class="horario-item" *ngIf="trabajador.horaSalidaManana">
                    <span class="horario-label">Salida:</span>
                    <span class="horario-value">{{ trabajador.horaSalidaManana }}</span>
                  </div>
                </div>
              </div>
              
              <!-- HORARIOS TARDE -->
              <div class="horario-turno" *ngIf="trabajador.horaEntradaTarde || trabajador.horaSalidaTarde">
                <div class="horario-turno-label">ğŸŒ† Tarde</div>
                <div class="horario-turno-items">
                  <div class="horario-item" *ngIf="trabajador.horaEntradaTarde">
                    <span class="horario-label">Entrada:</span>
                    <span class="horario-value">{{ trabajador.horaEntradaTarde }}</span>
                  </div>
                  <div class="horario-item" *ngIf="trabajador.horaSalidaTarde">
                    <span class="horario-label">Salida:</span>
                    <span class="horario-value">{{ trabajador.horaSalidaTarde }}</span>
                  </div>
                </div>
              </div>
              
              <!-- BADGE TARDANZA -->
              <div class="trabajador-tipo" *ngIf="trabajador.tipoMarcacion === 'Tardanza'">
                <span class="badge-tardanza">â° Tardanza</span>
              </div>
            </div>
            <div class="trabajador-sin-asistencia" *ngIf="!trabajador.tieneAsistencia">
              <span class="badge-falta">Sin registro</span>
            </div>
          </div>
        </div>

        <!-- MENSAJE SI NO HAY DATOS -->
        <div class="sin-datos" *ngIf="!cargandoDetalleAsistencia && (!detalleAsistenciaHoy || !detalleAsistenciaHoy.trabajadores || detalleAsistenciaHoy.trabajadores.length === 0)">
          <div class="sin-datos-icon">ğŸ“‹</div>
          <p class="sin-datos-mensaje">No se pudieron cargar los datos de asistencia</p>
          <button class="btn btn--primary" (click)="cargarDetalleAsistenciaHoy()">
            ğŸ”„ Reintentar
          </button>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn--outline" (click)="cerrarModalDetalleKPI()">
          Cerrar
        </button>
        <button class="btn btn--primary" (click)="irARuta()" *ngIf="detalleKPISeleccionado?.ruta">
          {{ detalleKPISeleccionado?.accion }}
        </button>
      </div>
    </div>

    <!-- MODAL NORMAL PARA OTROS KPIs -->
    <ng-template #modalKpiNormal>
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2 class="modal-title">{{ detalleKPISeleccionado?.titulo }}</h2>
          <button class="modal-close" (click)="cerrarModalDetalleKPI()">Ã—</button>
        </div>
        <div class="modal-body">
          <p class="modal-mensaje">{{ detalleKPISeleccionado?.mensaje }}</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn--outline" (click)="cerrarModalDetalleKPI()">
            Cerrar
          </button>
          <button class="btn btn--primary" (click)="irARuta()" *ngIf="detalleKPISeleccionado?.ruta">
            {{ detalleKPISeleccionado?.accion }}
          </button>
        </div>
      </div>
    </ng-template>
  </div>

  <!-- MODAL CALENDARIO COMPLETO -->
  <div class="modal-overlay modal-calendario" *ngIf="mostrarCalendarioCompleto" (click)="cerrarCalendarioCompleto()">
    <div class="modal-content modal-calendario-content" (click)="$event.stopPropagation()">
      <div class="modal-header modal-calendario-header">
        <div class="calendario-header-left">
          <h2 class="modal-title">ğŸ“… Calendario de Eventos</h2>
          <p class="calendario-subtitle">Vista completa de fechas importantes</p>
        </div>
        <button class="modal-close" (click)="cerrarCalendarioCompleto()">Ã—</button>
      </div>
      
      <div class="modal-body modal-calendario-body">
        <!-- NavegaciÃ³n del calendario -->
        <div class="calendario-navegacion">
          <button class="btn btn--icon btn-nav-mes" (click)="mesAnterior()">
            <span>â†</span>
          </button>
          <h3 class="calendario-mes-actual">
            {{ obtenerNombreMesCompleto(mesCalendario) }} {{ mesCalendario.getFullYear() }}
          </h3>
          <button class="btn btn--icon btn-nav-mes" (click)="mesSiguiente()">
            <span>â†’</span>
          </button>
          <button class="btn btn--sm btn--outline btn-hoy" (click)="irAHoy()">
            Hoy
          </button>
        </div>

        <!-- Calendario -->
        <div class="calendario-grid">
          <!-- DÃ­as de la semana -->
          <div class="calendario-dias-semana">
            <div class="dia-semana" *ngFor="let dia of diasSemana">{{ dia }}</div>
          </div>

          <!-- DÃ­as del mes -->
          <div class="calendario-dias">
            <div 
              *ngFor="let dia of obtenerDiasCalendario()"
              class="calendario-dia"
              [class.dia-otro-mes]="dia.esOtroMes"
              [class.dia-hoy]="dia.esHoy"
              [class.dia-con-evento]="dia.eventos && dia.eventos.length > 0"
            >
              <div class="dia-numero">{{ dia.numero }}</div>
              <div class="dia-eventos">
                <div 
                  *ngFor="let evento of dia.eventos"
                  class="evento-mini"
                  [class.evento-mini--planilla]="evento.tipo === 'planilla'"
                  [class.evento-mini--beneficio]="evento.tipo === 'beneficio'"
                  [class.evento-mini--vencimiento]="evento.tipo === 'vencimiento'"
                  [class.evento-mini--reunion]="evento.tipo === 'reunion'"
                  [title]="evento.titulo"
                >
                  <span class="evento-mini-icon">
                    <span *ngIf="evento.tipo === 'planilla'">ğŸ’°</span>
                    <span *ngIf="evento.tipo === 'beneficio'">ğŸ</span>
                    <span *ngIf="evento.tipo === 'vencimiento'">â°</span>
                    <span *ngIf="evento.tipo === 'reunion'">ğŸ‘¥</span>
                  </span>
                  <span class="evento-mini-texto">{{ evento.titulo }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Leyenda de eventos -->
        <div class="calendario-leyenda">
          <div class="leyenda-item">
            <span class="leyenda-color leyenda-planilla"></span>
            <span>Planilla</span>
          </div>
          <div class="leyenda-item">
            <span class="leyenda-color leyenda-beneficio"></span>
            <span>Beneficios</span>
          </div>
          <div class="leyenda-item">
            <span class="leyenda-color leyenda-vencimiento"></span>
            <span>Vencimientos</span>
          </div>
          <div class="leyenda-item">
            <span class="leyenda-color leyenda-reunion"></span>
            <span>Reuniones</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL: ConfiguraciÃ³n del GrÃ¡fico de Planilla -->
<div class="modal-overlay" *ngIf="mostrarModalConfigGrafico" (click)="cerrarModalConfigGrafico()">
  <div class="modal-content modal-config-grafico" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">
        <span class="modal-icon">âš™ï¸</span>
        Configurar GrÃ¡fico de Planilla
      </h3>
      <button class="modal-close" (click)="cerrarModalConfigGrafico()">Ã—</button>
    </div>
    
    <div class="modal-body">
      <!-- Tipo de GrÃ¡fico -->
      <div class="config-section">
        <label class="config-label">Tipo de GrÃ¡fico</label>
        <div class="config-options">
          <button 
            class="config-option"
            [class.active]="chartConfig.tipo === 'line'"
            (click)="cambiarTipoGrafico('line')"
          >
            <span class="option-icon">ğŸ“ˆ</span>
            <span class="option-text">LÃ­nea</span>
          </button>
          <button 
            class="config-option"
            [class.active]="chartConfig.tipo === 'bar'"
            (click)="cambiarTipoGrafico('bar')"
          >
            <span class="option-icon">ğŸ“Š</span>
            <span class="option-text">Barras</span>
          </button>
        </div>
      </div>
      
      <!-- PerÃ­odo -->
      <div class="config-section">
        <label class="config-label">PerÃ­odo</label>
        <select 
          class="config-select"
          [(ngModel)]="chartConfig.periodo"
        >
          <option value="ultimos-6-meses">Ãšltimos 6 meses</option>
          <option value="ultimos-8-meses">Ãšltimos 8 meses</option>
          <option value="ultimos-12-meses">Ãšltimos 12 meses</option>
          <option value="aÃ±o-actual">AÃ±o Actual</option>
          <option value="aÃ±o-anterior">AÃ±o Anterior</option>
        </select>
      </div>
      
      <!-- Color de LÃ­nea -->
      <div class="config-section">
        <label class="config-label">Color de LÃ­nea</label>
        <div class="config-colors">
          <button 
            *ngFor="let color of coloresDisponibles"
            class="color-option"
            [class.active]="chartConfig.colorLinea === color.valor"
            [style.background]="'linear-gradient(135deg, ' + color.gradiente.join(', ') + ')'"
            (click)="cambiarColorLinea(color.valor)"
            [title]="color.nombre"
          >
            <span class="color-check" *ngIf="chartConfig.colorLinea === color.valor">âœ“</span>
          </button>
        </div>
      </div>
      
      <!-- Estilo de Relleno -->
      <div class="config-section">
        <label class="config-label">Estilo de Relleno</label>
        <div class="config-options">
          <button 
            class="config-option"
            [class.active]="chartConfig.estiloRelleno === 'gradiente'"
            (click)="chartConfig.estiloRelleno = 'gradiente'"
          >
            <span class="option-icon">ğŸ¨</span>
            <span class="option-text">Gradiente</span>
          </button>
          <button 
            class="config-option"
            [class.active]="chartConfig.estiloRelleno === 'solido'"
            (click)="chartConfig.estiloRelleno = 'solido'"
          >
            <span class="option-icon">ğŸŸ¦</span>
            <span class="option-text">SÃ³lido</span>
          </button>
          <button 
            class="config-option"
            [class.active]="chartConfig.estiloRelleno === 'transparente'"
            (click)="chartConfig.estiloRelleno = 'transparente'"
          >
            <span class="option-icon">ğŸ‘ï¸</span>
            <span class="option-text">Sin relleno</span>
          </button>
        </div>
      </div>
      
      <!-- Opciones Adicionales -->
      <div class="config-section">
        <label class="config-label">Opciones</label>
        <div class="config-checkboxes">
          <label class="config-checkbox">
            <input 
              type="checkbox" 
              [(ngModel)]="chartConfig.mostrarGrid"
            >
            <span>Mostrar cuadrÃ­cula</span>
          </label>
          <label class="config-checkbox">
            <input 
              type="checkbox" 
              [(ngModel)]="chartConfig.mostrarLeyenda"
            >
            <span>Mostrar leyenda</span>
          </label>
          <label class="config-checkbox">
            <input 
              type="checkbox" 
              [(ngModel)]="chartConfig.colorRelleno"
            >
            <span>Relleno de color</span>
          </label>
          <label class="config-checkbox">
            <input 
              type="checkbox" 
              [(ngModel)]="chartConfig.mostrarPuntos"
            >
            <span>Mostrar puntos</span>
          </label>
          <label class="config-checkbox">
            <input 
              type="checkbox" 
              [(ngModel)]="chartConfig.animacion"
            >
            <span>Animaciones</span>
          </label>
          <label class="config-checkbox">
            <input 
              type="checkbox" 
              [(ngModel)]="chartConfig.mostrarPromedio"
            >
            <span>Mostrar promedio en tooltip</span>
          </label>
          <label class="config-checkbox">
            <input 
              type="checkbox" 
              [(ngModel)]="chartConfig.mostrarTendencia"
            >
            <span>Mostrar tendencia</span>
          </label>
          <label class="config-checkbox">
            <input 
              type="checkbox" 
              [(ngModel)]="chartConfig.suavizado"
            >
            <span>LÃ­nea suavizada</span>
          </label>
        </div>
      </div>
      
      <!-- Grosor de LÃ­nea -->
      <div class="config-section">
        <label class="config-label">Grosor de LÃ­nea: {{ chartConfig.grosorLinea }}px</label>
        <input 
          type="range" 
          class="config-range"
          min="1" 
          max="6" 
          step="1"
          [(ngModel)]="chartConfig.grosorLinea"
        >
        <div class="range-labels">
          <span>Delgado</span>
          <span>Grueso</span>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn--secondary" (click)="cerrarModalConfigGrafico()">
        Cancelar
      </button>
      <button class="btn btn--primary" (click)="aplicarConfiguracionGrafico()">
        Aplicar Cambios
      </button>
    </div>
  </div>
</div>