<div class="configuracion-container">
  <!-- HEADER -->
  <div class="page-header">
    <div class="page-header__left">
      <h1 class="page-title">
        <span class="page-title__icon">‚öôÔ∏è</span>
        Configuraci√≥n del Sistema
      </h1>
      <p class="page-subtitle">
        <span class="page-subtitle__dots">
          <span class="page-subtitle__dot page-subtitle__dot--large"></span>
          <span class="page-subtitle__dot page-subtitle__dot--medium"></span>
          <span class="page-subtitle__dot page-subtitle__dot--small"></span>
        </span>
        Gesti√≥n completa de par√°metros y ajustes del sistema
      </p>
    </div>
    <div class="page-header__right">
      <button class="btn btn--sm btn--outline" (click)="exportarConfiguracion()">
        üì§ Exportar
      </button>
      <button class="btn btn--sm btn--outline" (click)="restaurarDefecto()">
        ‚Ü©Ô∏è Restaurar
      </button>
      <button class="btn btn--sm btn--success" (click)="guardarConfiguracion()" [disabled]="guardando">
        {{ guardando ? 'üíæ Guardando...' : 'üíæ Guardar Cambios' }}
      </button>
    </div>
  </div>

  <!-- ALERTA DE CAMBIOS -->
  <div class="alerta-cambios" *ngIf="hayChangiosSinGuardar()">
    <div class="alerta-cambios__icon">‚ö†Ô∏è</div>
    <div class="alerta-cambios__content">
      <strong>Hay cambios sin guardar</strong>
      <p>Recuerde guardar los cambios antes de salir de esta secci√≥n</p>
    </div>
    <div class="alerta-cambios__acciones">
      <button class="btn btn--sm btn--ghost" (click)="cancelarCambios()">Cancelar</button>
    </div>
  </div>

  <!-- TABS NAVEGACI√ìN -->
  <div class="tabs-container">
    <div class="tabs-scroll">
      <div class="tabs">
        <button
          *ngFor="let tab of tabs"
          class="tab"
          [class.active]="tabActiva === tab.id"
          (click)="cambiarTab(tab.id)"
        >
          <span class="tab__icon">{{ tab.icon }}</span>
          <span class="tab__nombre">{{ tab.nombre }}</span>
        </button>
      </div>
    </div>
  </div>

  <!-- CONTENIDO DE TABS -->
  <div class="tab-content">

    <!-- ==================== TAB: EMPRESA ==================== -->
    <div class="tab-panel" *ngIf="tabActiva === 'empresa'">
      <h2 class="section-title">üè¢ Datos de la Empresa/Municipalidad</h2>

      <div class="form-section">
        <h3 class="form-section__title">üìã Informaci√≥n General</h3>
        <div class="form-grid">
          <div class="form-group form-group--full">
            <label class="form-label">Raz√≥n Social *</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa.razonSocial"
              (input)="detectarCambios()"
              placeholder="Municipalidad Distrital de..."
            />
          </div>

          <div class="form-group">
            <label class="form-label">Nombre Comercial</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.nombreComercial"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">RUC *</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.ruc"
              (input)="detectarCambios()"
              maxlength="11"
              placeholder="20123456789"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="form-label">Direcci√≥n</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.direccion"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Distrito</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.distrito"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Provincia</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.provincia"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Departamento</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.departamento"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Pa√≠s</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.pais"
              (input)="detectarCambios()"
              value="Per√∫"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üìû Contacto</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Tel√©fono</label>
            <input
              type="tel"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.telefono"
              (input)="detectarCambios()"
              placeholder="01-1234567"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Celular</label>
            <input
              type="tel"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.celular"
              (input)="detectarCambios()"
              placeholder="987654321"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Email</label>
            <input
              type="email"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.email"
              (input)="detectarCambios()"
              placeholder="contacto@municipalidad.gob.pe"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Sitio Web</label>
            <input
              type="url"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.web"
              (input)="detectarCambios()"
              placeholder="www.municipalidad.gob.pe"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üë• Autoridades</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Alcalde</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.alcalde"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Gerente Municipal</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.gerenteMunicipal"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Gerente de RRHH</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.gerenteRRHH"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Periodo de Gesti√≥n</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.periodoGestion"
              (input)="detectarCambios()"
              placeholder="2023-2026"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üìÑ Informaci√≥n Legal</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Actividad Econ√≥mica</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.actividadEconomica"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">C√≥digo CIIU</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.codigoCIIU"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Tipo de Contribuyente</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.tipoContribuyente"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">R√©gimen Tributario</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.empresa!.regimenTributario"
              (input)="detectarCambios()"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== TAB: PLANILLAS ==================== -->
    <div class="tab-panel" *ngIf="tabActiva === 'planillas'">
      <h2 class="section-title">üí∞ Configuraci√≥n de Planillas</h2>

      <!-- ALERTA INFO: Tasas se configuran en otra secci√≥n -->
      <div class="alert alert--info" style="margin-bottom: 2rem;">
        <div class="alert__icon">üí°</div>
        <div class="alert__content">
          <strong>Importante:</strong> Los porcentajes de AFP, ONP, Asignaci√≥n Familiar y descuentos se configuran en la pesta√±a <strong>"üìä Tasas y Conceptos"</strong> para mejor control y trazabilidad.
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üßÆ Par√°metros de C√°lculo</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              D√≠as del Mes 
              <span class="label-hint" title="Define si se usan 30 d√≠as fijos o los d√≠as reales del mes para calcular sueldos diarios">‚ÑπÔ∏è</span>
            </label>
            <select class="form-select" [(ngModel)]="configuracion.planillas!.diasDelMes" (change)="detectarCambios()">
              <option [value]="30">30 d√≠as (Est√°ndar)</option>
              <option value="real">D√≠as reales del mes</option>
            </select>
            <small class="form-hint">
              <strong>Ejemplo:</strong> Sueldo S/.3,000 por 15 d√≠as ‚Üí 
              Con 30 d√≠as: S/.1,500.00 | Con d√≠as reales (31): S/.1,451.61
            </small>
          </div>

          <div class="form-group">
            <label class="form-label">
              Horas por D√≠a Laboral
              <span class="label-hint" title="N√∫mero de horas de una jornada laboral completa">‚ÑπÔ∏è</span>
            </label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.planillas!.horasPorDia"
              (input)="detectarCambios()"
              min="1"
              max="24"
            />
            <small class="form-hint">Usado para calcular pago por hora y horas extras</small>
          </div>

          <div class="form-group">
            <label class="form-label">
              Decimales en Montos
              <span class="label-hint" title="Cantidad de decimales a mostrar en todos los montos">‚ÑπÔ∏è</span>
            </label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.planillas!.redondeoDecimales"
              (input)="detectarCambios()"
              min="0"
              max="4"
            />
            <small class="form-hint">Recomendado: 2 decimales (S/. 1,234.56)</small>
          </div>

          <div class="form-group">
            <label class="form-label">
              Tipo de Redondeo
              <span class="label-hint" title="M√©todo de redondeo de decimales">‚ÑπÔ∏è</span>
            </label>
            <select class="form-select" [(ngModel)]="configuracion.planillas!.redondeoTipo" (change)="detectarCambios()">
              <option value="normal">Normal (Matem√°tico)</option>
              <option value="arriba">Siempre hacia arriba</option>
              <option value="abajo">Siempre hacia abajo</option>
            </select>
            <small class="form-hint">Normal redondea S/. 10.125 ‚Üí S/. 10.13</small>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üìÖ Fechas Importantes</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              D√≠a de Cierre de Planilla
              <span class="label-hint" title="D√≠a l√≠mite para registrar asistencias y novedades">‚ÑπÔ∏è</span>
            </label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.planillas!.diaCierrePlanilla"
              (input)="detectarCambios()"
              min="1"
              max="31"
            />
            <small class="form-hint">
              Ej: <strong>25</strong> = La planilla se cierra el d√≠a 25 de cada mes
            </small>
          </div>

          <div class="form-group">
            <label class="form-label">
              D√≠a de Pago de Planilla
              <span class="label-hint" title="D√≠a en que se realiza el pago a los trabajadores">‚ÑπÔ∏è</span>
            </label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.planillas!.diaPagoPlanilla"
              (input)="detectarCambios()"
              min="1"
              max="31"
            />
            <small class="form-hint">
              Ej: <strong>30</strong> = El pago se efect√∫a el d√≠a 30 de cada mes
            </small>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">‚öôÔ∏è Automatizaci√≥n de Procesos</h3>
        <div class="opciones-grid">
          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.planillas!.calcularHorasExtrasAuto"
              (change)="detectarCambios()"
            />
            <span>
              <strong>Calcular horas extras autom√°ticamente</strong>
              <small style="display: block; color: #999; margin-top: 0.25rem;">
                El sistema detecta y calcula autom√°ticamente las horas extras seg√∫n asistencias
              </small>
            </span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.planillas!.aplicarRetencionAutomatica"
              (change)="detectarCambios()"
            />
            <span>
              <strong>Aplicar descuentos autom√°ticamente</strong>
              <small style="display: block; color: #999; margin-top: 0.25rem;">
                Aplica descuentos por tardanzas, faltas y otros seg√∫n las tasas configuradas
              </small>
            </span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.planillas!.generarBoletasAuto"
              (change)="detectarCambios()"
            />
            <span>
              <strong>Generar boletas autom√°ticamente</strong>
              <small style="display: block; color: #999; margin-top: 0.25rem;">
                Crea autom√°ticamente las boletas de pago al cerrar la planilla mensual
              </small>
            </span>
          </label>
        </div>
      </div>
    </div>

    <!-- ==================== TAB: TASAS Y CONCEPTOS ==================== -->
    <div class="tab-panel tasas-panel" *ngIf="tabActiva === 'tasas'">
      <!-- HEADER -->
      <div class="page-header">
        <div class="page-header__left">
          <h1 class="page-title">
            <span class="page-title__icon">üìä</span>
            Tasas y Conceptos Configurables
          </h1>
          <p class="page-subtitle">Gesti√≥n de tasas para c√°lculos de planilla</p>
        </div>
        <div class="page-header__right">
          <button class="btn btn--sm btn--outline" (click)="cargarTasas()">
            üîÑ Actualizar
          </button>
          <button class="btn btn--sm btn--primary" (click)="nuevaTasa()">
            ‚ûï Nueva Tasa
          </button>
        </div>
      </div>

      <!-- INFORMACI√ìN IMPORTANTE -->
      <div class="alert alert--info" style="margin-bottom: 2rem;">
        <div class="alert__icon">‚ÑπÔ∏è</div>
        <div class="alert__content">
          <strong>Informaci√≥n Importante</strong>
          <ul style="margin: 0.5rem 0 0 0; padding-left: 1.2rem;">
            <li>Las tasas configurables se utilizan autom√°ticamente en los c√°lculos de planilla.</li>
            <li>Los cambios afectan solo a las planillas futuras, no a las ya generadas.</li>
            <li>Las tasas pueden tener vigencia temporal usando las fechas de inicio y fin.</li>
            <li>El sistema selecciona autom√°ticamente la tasa vigente seg√∫n la fecha actual.</li>
          </ul>
        </div>
      </div>

      <!-- CATEGOR√çAS DE TASAS -->
      <div class="tasas-container">
        <div *ngFor="let categoria of Object.keys(tasasCategorizadas)" class="tasa-categoria-section">
          <div class="categoria-header">
            <!-- T√çTULO DE CATEGOR√çA (EDITABLE) -->
            <div class="categoria-title-wrapper" style="display: flex; align-items: center; gap: 0.75rem; width: 100%;">
              <h3 class="categoria-title" *ngIf="categoriaEditando !== categoria" style="margin: 0; display: flex; align-items: center; gap: 0.5rem; flex: 1;">
                <span class="categoria-icon">
                  {{ categoria === 'AFP' || categoria === 'AFP - Fondo de Pensiones' ? 'üè¶' : 
                     categoria === 'ONP' || categoria === 'ONP - Sistema de Pensiones' ? 'üèõÔ∏è' : 
                     categoria === 'EsSalud' || categoria === 'Salud' ? 'üè•' : 
                     categoria === 'Renta' || categoria === 'Renta de 5ta Categor√≠a' ? 'üíº' : 
                     categoria === 'APORTES' || categoria === 'Aportes' ? 'üí∞' : 
                     categoria === 'SCTR' ? 'üõ°Ô∏è' : 
                     categoria === 'SEGUROS' ? 'üîí' : 'üìå' }}
                </span>
                {{ categoria }}
              </h3>
              
              <!-- INPUT EDITABLE -->
              <div *ngIf="categoriaEditando === categoria" style="display: flex; align-items: center; gap: 0.5rem; flex: 1;">
                <span class="categoria-icon">
                  {{ categoria === 'AFP' || categoria === 'AFP - Fondo de Pensiones' ? 'üè¶' : 
                     categoria === 'ONP' || categoria === 'ONP - Sistema de Pensiones' ? 'üèõÔ∏è' : 
                     categoria === 'EsSalud' || categoria === 'Salud' ? 'üè•' : 
                     categoria === 'Renta' || categoria === 'Renta de 5ta Categor√≠a' ? 'üíº' : 
                     categoria === 'APORTES' || categoria === 'Aportes' ? 'üí∞' : 
                     categoria === 'SCTR' ? 'üõ°Ô∏è' : 
                     categoria === 'SEGUROS' ? 'üîí' : 'üìå' }}
                </span>
                <input 
                  type="text" 
                  class="form-input" 
                  [(ngModel)]="categoriaNombreEditando"
                  (keyup.enter)="guardarNombreCategoria(categoria)"
                  (keyup.escape)="cancelarEdicionCategoria()"
                  style="flex: 1; font-size: 1.25rem; font-weight: 600; padding: 0.5rem 0.75rem;"
                  [disabled]="guardandoNombreCategoria"
                  #categoriaInput
                  (focus)="categoriaInput.select()"
                />
                <button 
                  class="btn btn--sm btn--primary" 
                  (click)="guardarNombreCategoria(categoria)"
                  [disabled]="guardandoNombreCategoria || !categoriaNombreEditando.trim()"
                  style="margin: 0; min-width: 40px;">
                  {{ guardandoNombreCategoria ? '‚è≥' : '‚úì' }}
                </button>
                <button 
                  class="btn btn--sm btn--outline" 
                  (click)="cancelarEdicionCategoria()"
                  [disabled]="guardandoNombreCategoria"
                  style="margin: 0; min-width: 40px;">
                  ‚úï
                </button>
              </div>
              
              <!-- BOT√ìN EDITAR -->
              <button 
                *ngIf="categoriaEditando !== categoria"
                class="btn btn--sm btn--outline" 
                (click)="iniciarEdicionCategoria(categoria)"
                style="padding: 0.375rem 0.75rem; white-space: nowrap;"
                title="Editar nombre de categor√≠a">
                ‚úèÔ∏è Editar
              </button>
              
              <span class="categoria-count" style="margin-left: auto;">{{ tasasCategorizadas[categoria].length }} tasa(s)</span>
            </div>
          </div>
          
          <div class="tabla-responsive" *ngIf="tasasCategorizadas[categoria].length > 0">
            <table class="tabla-moderna">
              <thead>
                <tr>
                  <th width="15%">C√≥digo</th>
                  <th width="25%">Nombre</th>
                  <th width="12%">Valor</th>
                  <th width="10%">Tipo</th>
                  <th width="18%">Vigencia</th>
                  <th width="10%">Estado</th>
                  <th width="10%">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let tasa of tasasCategorizadas[categoria]" class="tabla-row">
                  <td>
                    <code class="codigo-badge">{{ tasa.Codigo }}</code>
                  </td>
                  <td>
                    <div class="tasa-info">
                      <span class="tasa-nombre">{{ tasa.Nombre }}</span>
                      <small class="tasa-descripcion" *ngIf="tasa.Descripcion">{{ tasa.Descripcion }}</small>
                    </div>
                  </td>
                  <td>
                    <span class="valor-destacado">{{ formatearValorTasa(tasa.Valor, tasa.TipoValor) }}</span>
                  </td>
                  <td>
                    <span class="badge badge--{{ tasa.TipoValor === 'Porcentaje' ? 'info' : tasa.TipoValor === 'Monto' ? 'success' : tasa.TipoValor === 'Cantidad' ? 'warning' : 'secondary' }}">
                      {{ tasa.TipoValor }}
                    </span>
                  </td>
                  <td>
                    <div class="vigencia-info">
                      <small class="vigencia-desde">
                        <span class="vigencia-label">Desde:</span> {{ tasa.FechaVigenciaInicio | date:'dd/MM/yyyy' }}
                      </small>
                      <small class="vigencia-hasta" *ngIf="tasa.FechaVigenciaFin">
                        <span class="vigencia-label">Hasta:</span> {{ tasa.FechaVigenciaFin | date:'dd/MM/yyyy' }}
                      </small>
                      <small class="vigencia-indefinida" *ngIf="!tasa.FechaVigenciaFin">
                        <span class="vigencia-label">Vigencia:</span> Indefinida
                      </small>
                    </div>
                  </td>
                  <td>
                    <span class="badge" [class.badge--success]="tasa.Activo" [class.badge--danger]="!tasa.Activo">
                      {{ tasa.Activo ? '‚úì Activo' : '‚úó Inactivo' }}
                    </span>
                  </td>
                  <td>
                    <div class="acciones-grupo">
                      <button class="btn-icon btn-icon--edit" (click)="editarTasa(tasa)" title="Editar tasa">
                        ‚úèÔ∏è
                      </button>
                      <button class="btn-icon btn-icon--delete" (click)="eliminarTasa(tasa)" title="Eliminar tasa">
                        üóëÔ∏è
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="empty-state" *ngIf="tasasCategorizadas[categoria].length === 0">
            <div class="empty-state__icon">üì≠</div>
            <p class="empty-state__text">No hay tasas en esta categor√≠a</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== TAB: BENEFICIOS ==================== -->
    <div class="tab-panel" *ngIf="tabActiva === 'beneficios'">
      <h2 class="section-title">üéÅ Configuraci√≥n de Beneficios</h2>

      <!-- CTS -->
      <div class="form-section">
        <h3 class="form-section__title">üí∞ CTS (Compensaci√≥n por Tiempo de Servicios)</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Tasa de Inter√©s (%)</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.cts.tasaInteres"
              (input)="detectarCambios()"
              step="0.1"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Banco Depositario</label>
            <select class="form-select" [(ngModel)]="configuracion.beneficios!.cts.bancoDepositario" (change)="detectarCambios()">
              <option *ngFor="let banco of bancosDisponibles" [value]="banco">{{ banco }}</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">D√≠as por A√±o</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.cts.diasPorAnio"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Meses Promedio Horas Extras</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.cts.mesesPromedioHorasExtras"
              (input)="detectarCambios()"
              min="1"
              max="12"
            />
          </div>

          <div class="form-group">
            <label class="form-label">D√≠a Dep√≥sito Mayo</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.cts.fechaDepositoMayo"
              (input)="detectarCambios()"
              min="1"
              max="31"
            />
          </div>

          <div class="form-group">
            <label class="form-label">D√≠a Dep√≥sito Noviembre</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.cts.fechaDepositoNoviembre"
              (input)="detectarCambios()"
              min="1"
              max="31"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.beneficios!.cts.incluirGratificacionesEnCalculo"
                (change)="detectarCambios()"
              />
              <span>Incluir gratificaciones en el c√°lculo</span>
            </label>
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.beneficios!.cts.incluirHorasExtrasEnCalculo"
                (change)="detectarCambios()"
              />
              <span>Incluir horas extras en el c√°lculo</span>
            </label>
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.beneficios!.cts.generarDepositosAuto"
                (change)="detectarCambios()"
              />
              <span>Generar dep√≥sitos autom√°ticamente</span>
            </label>
          </div>
        </div>
      </div>

      <!-- GRATIFICACIONES -->
      <div class="form-section">
        <h3 class="form-section__title">üéÅ Gratificaciones</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Bonificaci√≥n Extraordinaria (%)</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.gratificaciones.porcentajeBonificacionExtraordinaria"
              (input)="detectarCambios()"
              step="0.1"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Mes Gratificaci√≥n Julio</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.gratificaciones.mesGratificacionJulio"
              (input)="detectarCambios()"
              min="1"
              max="12"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Mes Gratificaci√≥n Diciembre</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.gratificaciones.mesGratificacionDiciembre"
              (input)="detectarCambios()"
              min="1"
              max="12"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.beneficios!.gratificaciones.aplicarRetencionRenta"
                (change)="detectarCambios()"
              />
              <span>Aplicar retenci√≥n de renta 5ta</span>
            </label>
          </div>
        </div>
      </div>

      <!-- VACACIONES -->
      <div class="form-section">
        <h3 class="form-section__title">üèñÔ∏è Vacaciones</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">D√≠as por A√±o</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.vacaciones.diasPorAnio"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">D√≠as M√≠nimo Continuo</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.vacaciones.diasMinimoContinuo"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">D√≠as M√°ximo Fraccionamiento</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.vacaciones.diasMaximoFraccionamiento"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">D√≠as Anticipaci√≥n Solicitud</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.vacaciones.diasAnticipacionSolicitud"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">A√±os M√°ximos Acumulaci√≥n</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.vacaciones.aniosMaximosAcumulacion"
              (input)="detectarCambios()"
              min="1"
              max="5"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.beneficios!.vacaciones.permitirFraccionamiento"
                (change)="detectarCambios()"
              />
              <span>Permitir fraccionamiento de vacaciones</span>
            </label>
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.beneficios!.vacaciones.permitirAcumulacion"
                (change)="detectarCambios()"
              />
              <span>Permitir acumulaci√≥n de vacaciones</span>
            </label>
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.beneficios!.vacaciones.generarRecordAutomatico"
                (change)="detectarCambios()"
              />
              <span>Generar record vacacional autom√°tico</span>
            </label>
          </div>
        </div>
      </div>

      <!-- UTILIDADES -->
      <div class="form-section">
        <h3 class="form-section__title">üíº Utilidades</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">% Distribuci√≥n a Trabajadores</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.utilidades.porcentajeDistribucionTrabajadores"
              (input)="detectarCambios()"
              step="0.1"
            />
          </div>

          <div class="form-group">
            <label class="form-label">% Por D√≠as</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.utilidades.porcentajePorDias"
              (input)="detectarCambios()"
              step="0.1"
            />
          </div>

          <div class="form-group">
            <label class="form-label">% Por Remuneraci√≥n</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.utilidades.porcentajePorRemuneracion"
              (input)="detectarCambios()"
              step="0.1"
            />
          </div>

          <div class="form-group">
            <label class="form-label">D√≠as A√±o Completo</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.beneficios!.utilidades.diasAnioCompleto"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.beneficios!.utilidades.aplicarRenta5ta"
                (change)="detectarCambios()"
              />
              <span>Aplicar Renta 5ta Categor√≠a</span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== TAB: ASISTENCIA ==================== -->
    <div class="tab-panel" *ngIf="tabActiva === 'asistencia'">
      <h2 class="section-title">üìÖ Configuraci√≥n de Asistencia</h2>

      <div class="form-section">
        <h3 class="form-section__title">‚è∞ Tolerancias</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Minutos Tolerancia Tardanza</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.asistencia!.minutosToleranciaTardanza"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Tardanzas M√°ximas por Mes</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.asistencia!.tardanzasMaximasMes"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Faltas M√°ximas por Mes</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.asistencia!.faltasMaximasMes"
              (input)="detectarCambios()"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üî¢ Tipo de Marcaci√≥n</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Sistema de Marcaci√≥n</label>
            <select class="form-select" [(ngModel)]="configuracion.asistencia!.tipoMarcacion" (change)="detectarCambios()">
              <option value="biometrico">Biom√©trico</option>
              <option value="manual">Manual</option>
              <option value="mixto">Mixto</option>
            </select>
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.asistencia!.requiereJustificacionTardanza"
                (change)="detectarCambios()"
              />
              <span>Requiere justificaci√≥n para tardanzas</span>
            </label>
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.asistencia!.requiereJustificacionFalta"
                (change)="detectarCambios()"
              />
              <span>Requiere justificaci√≥n para faltas</span>
            </label>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">‚è±Ô∏è Horas Extras</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Porcentaje HE al 25%</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.asistencia!.porcentajeHE25"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Porcentaje HE al 35%</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.asistencia!.porcentajeHE35"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Porcentaje HE al 100%</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.asistencia!.porcentajeHE100"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.asistencia!.permitirHorasExtras"
                (change)="detectarCambios()"
              />
              <span>Permitir horas extras</span>
            </label>
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.asistencia!.requiereAprobacionHE"
                (change)="detectarCambios()"
              />
              <span>Requiere aprobaci√≥n de horas extras</span>
            </label>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üìä Reportes</h3>
        <div class="opciones-grid">
          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.asistencia!.generarReportesDiarios"
              (change)="detectarCambios()"
            />
            <span>Generar reportes diarios autom√°ticamente</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.asistencia!.enviarAlertasTardanzas"
              (change)="detectarCambios()"
            />
            <span>Enviar alertas de tardanzas</span>
          </label>
        </div>
      </div>
    </div>

    <!-- ==================== TAB: RRHH ==================== -->
    <div class="tab-panel" *ngIf="tabActiva === 'rrhh'">
      <h2 class="section-title">üë• Configuraci√≥n de RRHH</h2>

      <div class="form-section">
        <h3 class="form-section__title">üìä Evaluaci√≥n de Desempe√±o</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Periodo de Evaluaci√≥n</label>
            <select class="form-select" [(ngModel)]="configuracion.rrhh!.periodoEvaluacionDesempeno" (change)="detectarCambios()">
              <option value="mensual">Mensual</option>
              <option value="trimestral">Trimestral</option>
              <option value="semestral">Semestral</option>
              <option value="anual">Anual</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Fecha de Reuni√≥n de Evaluaci√≥n</label>
            <input
              type="date"
              class="form-input"
              [ngModel]="formatearFechaParaDateInput(configuracion.rrhh!.fechaReunionEvaluacion)"
              (ngModelChange)="onFechaReunionEvaluacionChange($event)"
              [ngModelOptions]="{ updateOn: 'blur' }"
            />
            <small class="form-hint">Fecha de la pr√≥xima reuni√≥n de evaluaci√≥n de desempe√±o</small>
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.rrhh!.permitirAutoevaluacion"
                (change)="detectarCambios()"
              />
              <span>Permitir autoevaluaci√≥n</span>
            </label>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üéì Capacitaciones</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Horas Capacitaci√≥n Anual</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.rrhh!.horasCapacitacionAnual"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Presupuesto Capacitaci√≥n (S/.)</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.rrhh!.presupuestoCapacitacion"
              (input)="detectarCambios()"
              step="0.01"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üîî Notificaciones</h3>
        <div class="opciones-grid">
          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.rrhh!.notificarCumpleanos"
              (change)="detectarCambios()"
            />
            <span>Notificar cumplea√±os de trabajadores</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.rrhh!.notificarAniversarios"
              (change)="detectarCambios()"
            />
            <span>Notificar aniversarios laborales</span>
          </label>
        </div>
      </div>
    </div>

    <!-- ==================== TAB: DATOS MAESTROS ==================== -->
    <div class="tab-panel" *ngIf="tabActiva === 'datos-maestros'">
      <h2 class="section-title">üóÇÔ∏è Administraci√≥n de Datos Maestros</h2>
      <p class="section-description">Gesti√≥n centralizada de todos los datos maestros del sistema (cargos, √°reas, gerencias, etc.)</p>

      <!-- NAVEGACI√ìN DE SUBSECCIONES -->
      <div class="subsecciones-nav">
        <button 
          *ngFor="let subseccion of subseccionesDatosMaestros"
          class="subseccion-btn"
          [class.active]="subseccionActiva === subseccion.id"
          (click)="cambiarSubseccion(subseccion.id)"
        >
          <span class="subseccion-btn__icon">{{ subseccion.icon }}</span>
          <span class="subseccion-btn__nombre">{{ subseccion.nombre }}</span>
          <span class="subseccion-btn__count">{{ subseccion.count }}</span>
        </button>
      </div>

      <!-- CONTENIDO DE SUBSECCIONES -->
      <div class="subseccion-content">
        
        <!-- CARGOS -->
        <div class="subseccion-panel" *ngIf="subseccionActiva === 'cargos'">
          <div class="panel-header">
            <h3>üëî Gesti√≥n de Cargos</h3>
            <div class="panel-header__actions">
              <button 
                class="btn btn--danger btn--sm" 
                (click)="eliminarCargosSeleccionados()"
                [disabled]="cargosSeleccionados.length === 0"
                *ngIf="cargosSeleccionados.length > 0"
              >
                üóëÔ∏è Eliminar Seleccionados ({{ cargosSeleccionados.length }})
              </button>
              <button class="btn btn--primary btn--sm" (click)="abrirModalNuevoCargo()">
                ‚ûï Nuevo Cargo
              </button>
            </div>
          </div>
          
          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th class="th-checkbox">
                    <input 
                      type="checkbox" 
                      [checked]="todosCargosSeleccionados"
                      (change)="toggleTodosCargos()"
                    />
                  </th>
                  <th class="th-codigo">C√≥digo</th>
                  <th class="th-nombre">Nombre</th>
                  <th class="th-descripcion">Descripci√≥n</th>
                  <th class="th-estado">Estado</th>
                  <th class="th-acciones">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let cargo of cargos">
                  <td class="td-checkbox">
                    <input 
                      type="checkbox" 
                      [checked]="estaCargoSeleccionado(cargo.CargoID)"
                      (change)="toggleSeleccionCargo(cargo.CargoID)"
                    />
                  </td>
                  <td><code>{{ cargo.CargoID }}</code></td>
                  <td><strong>{{ cargo.Nombre }}</strong></td>
                  <td>{{ cargo.Descripcion || 'Sin descripci√≥n' }}</td>
                  <td>
                    <span class="status-badge active">
                      Activo
                    </span>
                  </td>
                  <td class="td-acciones">
                    <div class="acciones-buttons">
                      <button class="btn btn--sm btn--outline" (click)="abrirModalEditarCargo(cargo)">
                        ‚úèÔ∏è Editar
                      </button>
                      <button class="btn btn--sm btn--danger" (click)="eliminarCargo(cargo)">
                        üóëÔ∏è Eliminar
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- GERENCIAS -->
        <div class="subseccion-panel" *ngIf="subseccionActiva === 'gerencias'">
          <div class="panel-header">
            <h3>üèõÔ∏è Gesti√≥n de Gerencias</h3>
            <button class="btn btn--primary btn--sm" (click)="nuevaGerencia()">
              ‚ûï Nueva Gerencia
            </button>
          </div>
          
          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th class="th-codigo">C√≥digo</th>
                  <th class="th-nombre">Nombre</th>
                  <th class="th-descripcion">Descripci√≥n</th>
                  <th class="th-estado">Estado</th>
                  <th class="th-acciones">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let gerencia of gerencias">
                  <td><code>{{ gerencia.GerenciaID }}</code></td>
                  <td><strong>{{ gerencia.Nombre }}</strong></td>
                  <td>{{ gerencia.Descripcion || 'Sin descripci√≥n' }}</td>
                  <td>
                    <span class="status-badge active">
                      Activo
                    </span>
                  </td>
                  <td class="td-acciones">
                    <div class="acciones-buttons">
                      <button class="btn btn--sm btn--outline" (click)="editarGerencia(gerencia)">
                        ‚úèÔ∏è Editar
                      </button>
                      <button class="btn btn--sm btn--danger" (click)="eliminarGerencia(gerencia)">
                        üóëÔ∏è Eliminar
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- SUBGERENCIAS -->
        <div class="subseccion-panel" *ngIf="subseccionActiva === 'subgerencias'">
          <div class="panel-header">
            <h3>üè¢ Gesti√≥n de Subgerencias</h3>
            <button class="btn btn--primary btn--sm" (click)="nuevaSubgerencia()">
              ‚ûï Nueva Subgerencia
            </button>
          </div>
          
          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th class="th-codigo">C√≥digo</th>
                  <th class="th-nombre">Nombre</th>
                  <th class="th-descripcion">Gerencia</th>
                  <th class="th-estado">Estado</th>
                  <th class="th-acciones">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let subgerencia of subgerencias">
                  <td><code>{{ subgerencia.SubgerenciaID }}</code></td>
                  <td><strong>{{ subgerencia.Nombre }}</strong></td>
                  <td>{{ subgerencia.GerenciaNombre }}</td>
                  <td>
                    <span class="status-badge active">
                      Activo
                    </span>
                  </td>
                  <td class="td-acciones">
                    <div class="acciones-buttons">
                      <button class="btn btn--sm btn--outline" (click)="editarSubgerencia(subgerencia)">
                        ‚úèÔ∏è Editar
                      </button>
                      <button class="btn btn--sm btn--danger" (click)="eliminarSubgerencia(subgerencia)">
                        üóëÔ∏è Eliminar
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- UNIDADES -->
        <div class="subseccion-panel" *ngIf="subseccionActiva === 'unidades'">
          <div class="panel-header">
            <h3>üè¢ Gesti√≥n de Unidades</h3>
            <button class="btn btn--primary btn--sm" (click)="nuevaUnidad()">
              ‚ûï Nueva Unidad
            </button>
          </div>
          
          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th class="th-codigo">C√≥digo</th>
                  <th class="th-nombre">Nombre</th>
                  <th class="th-descripcion">Subgerencia</th>
                  <th class="th-estado">Estado</th>
                  <th class="th-acciones">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let unidad of unidades">
                  <td><code>{{ unidad.UnidadID }}</code></td>
                  <td><strong>{{ unidad.Nombre }}</strong></td>
                  <td>{{ unidad.SubgerenciaNombre }}</td>
                  <td>
                    <span class="status-badge active">
                      Activo
                    </span>
                  </td>
                  <td class="td-acciones">
                    <div class="acciones-buttons">
                      <button class="btn btn--sm btn--outline" (click)="editarUnidad(unidad)">
                        ‚úèÔ∏è Editar
                      </button>
                      <button class="btn btn--sm btn--danger" (click)="eliminarUnidad(unidad)">
                        üóëÔ∏è Eliminar
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- TIPOS DE CONTRATO -->
        <div class="subseccion-panel" *ngIf="subseccionActiva === 'tipos-contrato'">
          <div class="panel-header">
            <h3>üìã Gesti√≥n de Tipos de Contrato</h3>
            <button class="btn btn--primary btn--sm" (click)="abrirModalNuevoTipoContrato()">
              ‚ûï Nuevo Tipo
            </button>
          </div>
          
          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th class="th-codigo">C√≥digo</th>
                  <th class="th-nombre">Nombre</th>
                  <th class="th-descripcion">Descripci√≥n</th>
                  <th class="th-estado">Estado</th>
                  <th class="th-acciones">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let tipo of tiposContrato">
                  <td><code>{{ tipo.Codigo }}</code></td>
                  <td><strong>{{ tipo.Nombre }}</strong></td>
                  <td>{{ tipo.Descripcion || 'Sin descripci√≥n' }}</td>
                  <td>
                    <span class="status-badge active">
                      Activo
                    </span>
                  </td>
                  <td class="td-acciones">
                    <div class="acciones-buttons">
                      <button class="btn btn--sm btn--outline" (click)="abrirModalEditarTipoContrato(tipo)">
                        ‚úèÔ∏è Editar
                      </button>
                      <button class="btn btn--sm btn--danger" (click)="eliminarTipoContrato(tipo)">
                        üóëÔ∏è Eliminar
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- REG√çMENES LABORALES -->
        <div class="subseccion-panel" *ngIf="subseccionActiva === 'regimenes-laborales'">
          <div class="panel-header">
            <h3>‚öñÔ∏è Gesti√≥n de Reg√≠menes Laborales</h3>
            <button class="btn btn--primary btn--sm" (click)="abrirModalNuevoRegimenLaboral()">
              ‚ûï Nuevo R√©gimen
            </button>
          </div>
          
          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th class="th-codigo">C√≥digo</th>
                  <th class="th-nombre">Nombre</th>
                  <th class="th-descripcion">Descripci√≥n</th>
                  <th class="th-estado">Estado</th>
                  <th class="th-acciones">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let regimen of regimenesLaborales">
                  <td class="td-codigo"><code>{{ regimen.Codigo }}</code></td>
                  <td class="td-nombre"><strong>{{ regimen.Nombre }}</strong></td>
                  <td class="td-descripcion">{{ regimen.Descripcion || 'Sin descripci√≥n' }}</td>
                  <td class="td-estado">
                    <span class="status-badge active">
                      Activo
                    </span>
                  </td>
                  <td class="td-acciones">
                    <div class="acciones-buttons">
                      <button class="btn btn--sm btn--outline" (click)="abrirModalEditarRegimenLaboral(regimen)">
                        ‚úèÔ∏è Editar
                      </button>
                      <button class="btn btn--sm btn--danger" (click)="eliminarRegimenLaboral(regimen)">
                        üóëÔ∏è Eliminar
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- CONDICIONES LABORALES -->
        <div class="subseccion-panel" *ngIf="subseccionActiva === 'condiciones-laborales'">
          <div class="panel-header">
            <h3>üìå Gesti√≥n de Condiciones Laborales</h3>
            <button class="btn btn--primary btn--sm" (click)="abrirModalNuevoCondicionLaboral()">
              ‚ûï Nueva Condici√≥n Laboral
            </button>
          </div>
          
          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th class="th-codigo">C√≥digo</th>
                  <th class="th-nombre">Nombre</th>
                  <th class="th-descripcion">Descripci√≥n</th>
                  <th class="th-estado">Estado</th>
                  <th class="th-acciones">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let condicion of condicionesLaborales">
                  <td class="td-codigo"><code>{{ condicion.Codigo }}</code></td>
                  <td class="td-nombre"><strong>{{ condicion.Nombre }}</strong></td>
                  <td class="td-descripcion">{{ condicion.Descripcion || 'Sin descripci√≥n' }}</td>
                  <td class="td-estado">
                    <span class="status-badge active">
                      Activo
                    </span>
                  </td>
                  <td class="td-acciones">
                    <div class="acciones-buttons">
                      <button class="btn btn--sm btn--outline" (click)="abrirModalEditarCondicionLaboral(condicion)">
                        ‚úèÔ∏è Editar
                      </button>
                      <button class="btn btn--sm btn--danger" (click)="eliminarCondicionLaboral(condicion)">
                        üóëÔ∏è Eliminar
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>

    <!-- ==================== TAB: TRIBUTARIO ==================== -->
    <div class="tab-panel" *ngIf="tabActiva === 'tributario'">
      <h2 class="section-title">üèõÔ∏è Configuraci√≥n Tributaria</h2>

      <div class="form-section">
        <h3 class="form-section__title">üèõÔ∏è SUNAT</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Usuario SUNAT</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.tributario!.usuarioSUNAT"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Clave SUNAT</label>
            <input
              type="password"
              class="form-input"
              [(ngModel)]="configuracion.tributario!.claveSUNAT"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Versi√≥n PLAME</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.tributario!.versionPLAME"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Ruta PLAME</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.tributario!.rutaPLAME"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.tributario!.generarArchivosPLAMEAuto"
                (change)="detectarCambios()"
              />
              <span>Generar archivos PLAME autom√°ticamente</span>
            </label>
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.tributario!.generarPDTAuto"
                (change)="detectarCambios()"
              />
              <span>Generar PDT autom√°ticamente</span>
            </label>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üíµ UIT y Renta 5ta</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">UIT Actual (S/.)</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.tributario!.uitActual"
              (input)="detectarCambios()"
              step="1"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Deducci√≥n M√≠nima (UIT)</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.tributario!.deduccionMinima"
              (input)="detectarCambios()"
              step="0.1"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üè• EsSalud y Aportes</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Tasa EsSalud (%)</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.tributario!.tasaEsSalud"
              (input)="detectarCambios()"
              step="0.1"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Tarifa SCTR (%)</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.tributario!.tarifaSCTR"
              (input)="detectarCambios()"
              step="0.1"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Tasa ONP (%)</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.tributario!.tasaONP"
              (input)="detectarCambios()"
              step="0.1"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== TAB: SEGURIDAD ==================== -->
    <div class="tab-panel" *ngIf="tabActiva === 'seguridad'">
      <h2 class="section-title">üîê Configuraci√≥n de Seguridad</h2>

      <div class="form-section">
        <h3 class="form-section__title">üîë Pol√≠ticas de Contrase√±as</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Longitud M√≠nima</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.seguridad!.longitudMinimaPassword"
              (input)="detectarCambios()"
              min="6"
              max="20"
            />
          </div>

          <div class="form-group">
            <label class="form-label">D√≠as Expiraci√≥n</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.seguridad!.diasExpiracionPassword"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Intentos Fallidos para Bloqueo</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.seguridad!.bloquearTrasIntentosFallidos"
              (input)="detectarCambios()"
              min="3"
              max="10"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.seguridad!.requiereCaracteresEspeciales"
                (change)="detectarCambios()"
              />
              <span>Requiere caracteres especiales</span>
            </label>
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.seguridad!.requiereNumeros"
                (change)="detectarCambios()"
              />
              <span>Requiere n√∫meros</span>
            </label>
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.seguridad!.requiereMayusculas"
                (change)="detectarCambios()"
              />
              <span>Requiere may√∫sculas</span>
            </label>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">‚è±Ô∏è Sesiones</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Tiempo M√°ximo Sesi√≥n (minutos)</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.seguridad!.tiempoMaximoSesion"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Minutos Inactividad</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.seguridad!.minutosInactividad"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Sesiones Simult√°neas</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.seguridad!.sesionesSimultaneas"
              (input)="detectarCambios()"
              min="1"
              max="5"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.seguridad!.cerrarSesionInactividad"
                (change)="detectarCambios()"
              />
              <span>Cerrar sesi√≥n por inactividad</span>
            </label>
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.seguridad!.permitirRecordarDispositivo"
                (change)="detectarCambios()"
              />
              <span>Permitir recordar dispositivo</span>
            </label>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üìã Auditor√≠a</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Nivel de Auditor√≠a</label>
            <select class="form-select" [(ngModel)]="configuracion.seguridad!.nivelAuditoria" (change)="detectarCambios()">
              <option value="basico">B√°sico</option>
              <option value="medio">Medio</option>
              <option value="completo">Completo</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">D√≠as Retenci√≥n Logs</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.seguridad!.diasRetencionLogs"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.seguridad!.registrarCambios"
                (change)="detectarCambios()"
              />
              <span>Registrar todos los cambios</span>
            </label>
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.seguridad!.autenticacionDosFactores"
                (change)="detectarCambios()"
              />
              <span>Autenticaci√≥n de dos factores</span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== TAB: ADMINISTRAR ROLES ==================== -->
    <div class="tab-panel" *ngIf="tabActiva === 'administrar-roles' && (puedeVerRoles() || puedeVerUsuarios())">
      <h2 class="section-title">üëë Administraci√≥n de Roles y Usuarios</h2>
      <p class="section-description">Gesti√≥n completa de roles, permisos y usuarios del sistema</p>

      <!-- NAVEGACI√ìN DE SUBSECCIONES -->
      <div class="subsecciones-nav" *ngIf="puedeVerRoles() || puedeVerUsuarios()">
        <button 
          class="subseccion-btn"
          *ngIf="puedeVerRoles()"
          [class.active]="subseccionActiva === 'roles'"
          (click)="subseccionActiva = 'roles'"
        >
          <span class="subseccion-btn__icon">üëë</span>
          <span class="subseccion-btn__text">Roles y Permisos</span>
        </button>
        <button 
          class="subseccion-btn"
          *ngIf="puedeVerUsuarios()"
          [class.active]="subseccionActiva === 'usuarios'"
          (click)="subseccionActiva = 'usuarios'"
        >
          <span class="subseccion-btn__icon">üë•</span>
          <span class="subseccion-btn__text">Usuarios</span>
        </button>
      </div>

      <!-- CONTENIDO DE SUBSECCIONES -->
      <div class="subseccion-content">
        
        <!-- ROLES Y PERMISOS -->
        <div class="subseccion-panel" *ngIf="subseccionActiva === 'roles'">
          <div class="panel-header">
            <div class="panel-header__left">
              <h3 class="panel-title">üëë Gesti√≥n de Roles</h3>
              <p class="panel-description">Crear, editar y administrar roles del sistema con sus respectivos permisos</p>
            </div>
            <div class="panel-header__right">
              <button class="btn btn--primary" (click)="abrirModalCrearRol()">
                <span class="btn__icon">‚ûï</span>
                <span class="btn__text">Nuevo Rol</span>
              </button>
            </div>
          </div>

          <!-- LISTA DE ROLES -->
          <div class="roles-container" *ngIf="!rolesCargando; else loadingRoles">
            <div class="roles-grid">
              <div class="role-card" *ngFor="let rol of roles" [ngClass]="{
                'role-card--super': getRolDisplayName(rol.nombre) === 'Super Administrador',
                'role-card--admin': rol.nombre && (rol.nombre.toUpperCase() === 'ADMIN' || rol.nombre.toUpperCase() === 'ADMIN_NORMAL' || rol.nombre === 'Administrador')
              }">
                <div class="role-card__header">
                  <div class="role-card__icon">üëë</div>
                  <div class="role-card__info">
                    <h4 class="role-card__nombre">{{ getRolDisplayName(rol.nombre) }}</h4>
                    <p class="role-card__descripcion">{{ rol.descripcion || 'Sin descripci√≥n' }}</p>
                    <div class="role-card__permisos-count" *ngIf="rol.permisos">
                      <span class="permisos-count-badge">
                        {{ contarPermisosActivos(rol) }} / {{ contarPermisosTotales(rol) }} permisos
                      </span>
                    </div>
                  </div>
                  <div class="role-card__actions">
                    <button class="btn-icon btn-icon--edit" (click)="abrirModalEditarRol(rol)" title="Editar rol">
                      ‚úèÔ∏è
                    </button>
                    <button class="btn-icon btn-icon--delete" (click)="eliminarRol(rol)" title="Eliminar rol">
                      üóëÔ∏è
                    </button>
                  </div>
                </div>
                <div class="role-card__permisos">
                  <div class="permisos-grid" *ngIf="rol.permisos && Object.keys(rol.permisos).length > 0">
                    <div class="permiso-item" *ngFor="let seccion of Object.keys(rol.permisos)">
                      <div class="permiso-seccion">{{ seccion | titlecase }}</div>
                      <div class="permiso-detalles">
                        <span class="permiso-badge" 
                              *ngFor="let permiso of Object.keys(rol.permisos[seccion] || {})"
                              [class.active]="rol.permisos[seccion] && rol.permisos[seccion][permiso] === true">
                          {{ permiso | titlecase }}
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="permisos-vacios" *ngIf="!rol.permisos || Object.keys(rol.permisos).length === 0">
                    <p class="text-muted">Sin permisos configurados</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ng-template #loadingRoles>
            <div class="loading-state">
              <div class="loading-spinner"></div>
              <p>Cargando roles...</p>
            </div>
          </ng-template>
        </div>

        <!-- USUARIOS -->
        <div class="subseccion-panel" *ngIf="subseccionActiva === 'usuarios'">
          <div class="panel-header">
            <div class="panel-header__left">
              <h3 class="panel-title">üë• Gesti√≥n de Usuarios</h3>
              <p class="panel-description">Administrar usuarios del sistema y cambiar contrase√±as</p>
            </div>
            <div class="panel-header__right">
              <button class="btn btn--primary" (click)="abrirModalNuevoUsuario()" *ngIf="isAdmin">
                <span class="btn__icon">‚ûï</span>
                <span class="btn__text">Nuevo Usuario</span>
              </button>
            </div>
          </div>

          <!-- LISTA DE USUARIOS -->
          <div class="usuarios-container" *ngIf="!usuariosCargando; else loadingUsuarios">
            <div class="usuarios-table">
              <div class="table-header">
                <div class="table-cell">Usuario</div>
                <div class="table-cell">Rol</div>
                <div class="table-cell">Estado</div>
                <div class="table-cell">√öltimo Acceso</div>
                <div class="table-cell">Acciones</div>
              </div>
              <div class="table-row" *ngFor="let usuario of usuarios">
                <div class="table-cell">
                  <div class="usuario-info">
                    <div class="usuario-avatar" [style.background-color]="getColorAvatar(usuario)">
                      <span class="avatar-iniciales">{{ getInicialesUsuario(usuario) }}</span>
                      <span class="avatar-icono">{{ getIconoRol(usuario.rol) }}</span>
                    </div>
                    <div class="usuario-details">
                      <div class="usuario-nombre">{{ usuario.username }}</div>
                      <div class="usuario-email">{{ usuario.email || 'Sin email' }}</div>
                    </div>
                  </div>
                </div>
                <div class="table-cell">
                  <span
                    class="rol-badge rol-badge--{{ usuario.rol?.toLowerCase() }}"
                    [ngClass]="{
                      'rol-badge--superadmin': getRolDisplayName(usuario.rol) === 'Super Administrador',
                      'rol-badge--admin': usuario.rol && (usuario.rol.toUpperCase() === 'ADMIN' || usuario.rol.toUpperCase() === 'ADMIN_NORMAL' || usuario.rol === 'Administrador')
                    }"
                  >
                    {{ getRolDisplayName(usuario.rol) }}
                  </span>
                </div>
                <div class="table-cell">
                  <span class="estado-badge estado-badge--activo">
                    Activo
                  </span>
                </div>
                <div class="table-cell">
                  <span class="fecha-acceso">{{ formatearFecha(usuario.ultimoAcceso) || 'Nunca' }}</span>
                </div>
                <div class="table-cell">
                  <div class="acciones-usuario">
                    <button class="btn btn--sm btn--outline" (click)="abrirModalEditarUsuario(usuario)">
                      <span class="btn__icon">‚úèÔ∏è</span>
                      <span class="btn__text">Editar</span>
                    </button>
                    <button class="btn btn--sm btn--outline" (click)="abrirModalCambiarPassword(usuario)">
                      <span class="btn__icon">üîë</span>
                      <span class="btn__text">Contrase√±a</span>
                    </button>
                    <button 
                      class="btn btn--sm btn--danger" 
                      (click)="abrirModalEliminarUsuario(usuario)"
                      *ngIf="isAdmin"
                      title="Eliminar usuario permanentemente de la base de datos">
                      <span class="btn__icon">üóëÔ∏è</span>
                      <span class="btn__text">Eliminar</span>
                    </button>
                    <button 
                      class="btn btn--sm btn--danger" 
                      (click)="abrirModalResetearPassword(usuario)"
                      *ngIf="isAdmin"
                      title="Resetear contrase√±a (solo administradores)">
                      <span class="btn__icon">üîÑ</span>
                      <span class="btn__text">Resetear</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ng-template #loadingUsuarios>
            <div class="loading-state">
              <div class="loading-spinner"></div>
              <p>Cargando usuarios...</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>

    <!-- ==================== TAB: NOTIFICACIONES ==================== -->
  
  <!-- MODAL ELIMINAR USUARIO -->
  <div class="modal-overlay" *ngIf="mostrarModalEliminarUsuario">
    <div class="modal-content">
      <div class="modal-header">
        <h3>üóëÔ∏è Eliminar usuario</h3>
        <button class="btn btn--ghost" (click)="cerrarModalEliminarUsuario()">‚úñ</button>
      </div>
      <div class="modal-body">
        <p><strong>‚ö†Ô∏è ADVERTENCIA:</strong> Esta acci√≥n eliminar√° permanentemente el usuario de la base de datos. Esta acci√≥n no se puede deshacer.</p>
        <p><strong>Usuario:</strong> {{ usuarioAEliminar?.username }} ({{ usuarioAEliminar?.email || 'sin email' }})</p>
        <div class="form-group">
          <label class="form-label">Escriba <strong>ELIMINAR</strong> para confirmar</label>
          <input type="text" class="form-input" [(ngModel)]="confirmacionEliminar" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" (click)="cerrarModalEliminarUsuario()">Cancelar</button>
        <button class="btn btn--danger" (click)="eliminarUsuarioConfirmado()">Eliminar definitivamente</button>
      </div>
    </div>
  </div>

  <!-- MODAL: √âXITO ELIMINACI√ìN USUARIO -->
  <div class="modal-overlay modal--exito" *ngIf="mostrarModalExitoEliminacion" (click)="cerrarModalExitoEliminacion()">
    <div class="modal-content modal-content--exito" (click)="$event.stopPropagation()">
      <div class="exito-eliminacion-usuario">
        <!-- C√≠rculo de carga -->
        <div class="exito-eliminacion-usuario__loader" *ngIf="eliminandoUsuario">
          <div class="spinner spinner--success"></div>
        </div>
        
        <!-- Check de √©xito -->
        <div class="exito-eliminacion-usuario__check" *ngIf="eliminacionCompletada">
          <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" width="50" height="50">
            <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
            <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
          </svg>
        </div>
        
        <h3 class="exito-eliminacion-usuario__title">Usuario eliminado exitosamente</h3>
        <p class="exito-eliminacion-usuario__message" *ngIf="eliminacionCompletada">
          El usuario ha sido eliminado permanentemente de la base de datos.
        </p>
        <p class="exito-eliminacion-usuario__message" *ngIf="eliminandoUsuario">
          Eliminando usuario...
        </p>
      </div>
    </div>
  </div>

    <div class="tab-panel" *ngIf="tabActiva === 'notificaciones'">
      <h2 class="section-title">üìß Configuraci√≥n de Notificaciones</h2>

      <div class="form-section">
        <h3 class="form-section__title">üìß Servidor SMTP</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Servidor SMTP</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.notificaciones!.servidorSMTP"
              (input)="detectarCambios()"
              placeholder="smtp.gmail.com"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Puerto SMTP</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.notificaciones!.puertoSMTP"
              (input)="detectarCambios()"
              placeholder="587"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Usuario Email</label>
            <input
              type="email"
              class="form-input"
              [(ngModel)]="configuracion.notificaciones!.usuarioEmail"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Contrase√±a Email</label>
            <input
              type="password"
              class="form-input"
              [(ngModel)]="configuracion.notificaciones!.passwordEmail"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Email Remitente</label>
            <input
              type="email"
              class="form-input"
              [(ngModel)]="configuracion.notificaciones!.emailRemitente"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Nombre Remitente</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.notificaciones!.nombreRemitente"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.notificaciones!.usarSSL"
                (change)="detectarCambios()"
              />
              <span>Usar SSL/TLS</span>
            </label>
          </div>

          <div class="form-group form-group--full">
            <button class="btn btn--outline" (click)="probarConexionSMTP()">
              üîß Probar Conexi√≥n SMTP
            </button>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üîî Tipos de Notificaciones</h3>
        <div class="opciones-grid">
          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.notificaciones!.notificarNuevoPlanilla"
              (change)="detectarCambios()"
            />
            <span>Notificar nueva planilla</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.notificaciones!.notificarPagoRealizado"
              (change)="detectarCambios()"
            />
            <span>Notificar pago realizado</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.notificaciones!.notificarCumpleanos"
              (change)="detectarCambios()"
            />
            <span>Notificar cumplea√±os</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.notificaciones!.notificarVencimientos"
              (change)="detectarCambios()"
            />
            <span>Notificar vencimientos</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.notificaciones!.notificarTardanzas"
              (change)="detectarCambios()"
            />
            <span>Notificar tardanzas</span>
          </label>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üìÖ Res√∫menes</h3>
        <div class="opciones-grid">
          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.notificaciones!.resumenDiario"
              (change)="detectarCambios()"
            />
            <span>Resumen diario</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.notificaciones!.resumenSemanal"
              (change)="detectarCambios()"
            />
            <span>Resumen semanal</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.notificaciones!.resumenMensual"
              (change)="detectarCambios()"
            />
            <span>Resumen mensual</span>
          </label>
        </div>
      </div>
    </div>

    <!-- ==================== TAB: PERSONALIZACI√ìN ==================== -->
    
    <!-- ==================== TAB: M√ìDULOS (SOLO SUPER_ADMIN) ==================== -->
    <div class="tab-panel" *ngIf="tabActiva === 'modulos' && isSuperAdmin">
      <h2 class="section-title">üß© M√≥dulos del Sistema</h2>
      <p class="panel-description">Activa o desactiva m√≥dulos visibles para administradores normales. T√∫, como Super Administrador, siempre ver√°s todos.</p>
      <div class="form-section">
        <h3 class="form-section__title">M√≥dulos disponibles</h3>
        <div class="opciones-grid">
          <label class="opcion-check" *ngFor="let tab of tabs">
            <input type="checkbox" [(ngModel)]="modulosHabilitados[tab.id]" />
            <span>{{ tab.nombre }}</span>
          </label>
        </div>
        <div class="form-actions" style="margin-top: 1rem;">
          <button class="btn btn--primary" (click)="guardarModulosHabilitados()">üíæ Guardar</button>
        </div>
      </div>
    </div>
    <div class="tab-panel" *ngIf="tabActiva === 'personalizacion'">
      <h2 class="section-title">üé® Personalizaci√≥n del Sistema</h2>

      <div class="form-section">
        <h3 class="form-section__title">üé® Tema y Colores</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Tema</label>
            <select class="form-select" [(ngModel)]="configuracion.personalizacion!.tema" (change)="detectarCambios()">
              <option value="light">Claro</option>
              <option value="dark">Oscuro</option>
              <option value="auto">Autom√°tico</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Color Primario</label>
            <input
              type="color"
              class="form-input"
              [(ngModel)]="configuracion.personalizacion!.colorPrimario"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Color Secundario</label>
            <input
              type="color"
              class="form-input"
              [(ngModel)]="configuracion.personalizacion!.colorSecundario"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Color Accent</label>
            <input
              type="color"
              class="form-input"
              [(ngModel)]="configuracion.personalizacion!.colorAccent"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Tama√±o de Fuente</label>
            <select class="form-select" [(ngModel)]="configuracion.personalizacion!.tamanioFuente" (change)="detectarCambios()">
              <option value="pequeno">Peque√±o</option>
              <option value="mediano">Mediano</option>
              <option value="grande">Grande</option>
            </select>
          </div>

          <div class="form-group form-group--full">
            <button class="btn btn--primary" (click)="aplicarPersonalizacion()">
              üé® Aplicar Cambios Visuales
            </button>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üìã Formatos</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Formato de Fecha</label>
            <select class="form-select" [(ngModel)]="configuracion.personalizacion!.formatoFecha" (change)="detectarCambios()">
              <option value="DD/MM/YYYY">DD/MM/YYYY</option>
              <option value="MM/DD/YYYY">MM/DD/YYYY</option>
              <option value="YYYY-MM-DD">YYYY-MM-DD</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Formato de Hora</label>
            <select class="form-select" [(ngModel)]="configuracion.personalizacion!.formatoHora" (change)="detectarCambios()">
              <option value="HH:mm">24 horas (HH:mm)</option>
              <option value="hh:mm a">12 horas (hh:mm a)</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Separador Decimal</label>
            <select class="form-select" [(ngModel)]="configuracion.personalizacion!.separadorDecimal" (change)="detectarCambios()">
              <option value=".">Punto (.)</option>
              <option value=",">Coma (,)</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Separador de Miles</label>
            <select class="form-select" [(ngModel)]="configuracion.personalizacion!.separadorMiles" (change)="detectarCambios()">
              <option value=",">Coma (,)</option>
              <option value=".">Punto (.)</option>
                            <option value=" ">Espacio ( )</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Idioma</label>
            <select class="form-select" [(ngModel)]="configuracion.personalizacion!.idioma" (change)="detectarCambios()">
              <option value="es">Espa√±ol</option>
              <option value="en">English</option>
              <option value="qu">Quechua</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">‚öôÔ∏è Opciones de Interfaz</h3>
        <div class="opciones-grid">
          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.personalizacion!.animaciones"
              (change)="detectarCambios()"
            />
            <span>Animaciones</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.personalizacion!.sonidos"
              (change)="detectarCambios()"
            />
            <span>Sonidos</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.personalizacion!.modoAccesibilidad"
              (change)="detectarCambios()"
            />
            <span>Modo Accesibilidad</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.personalizacion!.incluirLogoEnReportes"
              (change)="detectarCambios()"
            />
            <span>Incluir logo en reportes</span>
          </label>
        </div>
      </div>
    </div>

    <!-- ==================== TAB: BACKUP ==================== -->
    <div class="tab-panel" *ngIf="tabActiva === 'backup'">
      <h2 class="section-title">üíæ Configuraci√≥n de Backup</h2>

      <div class="form-section">
        <h3 class="form-section__title">üîÑ Backup Autom√°tico</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Frecuencia</label>
            <select class="form-select" [(ngModel)]="configuracion.backup!.frecuenciaBackup" (change)="detectarCambios()">
              <option value="diario">Diario</option>
              <option value="semanal">Semanal</option>
              <option value="mensual">Mensual</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Hora de Ejecuci√≥n</label>
            <input
              type="time"
              class="form-input"
              [(ngModel)]="configuracion.backup!.horaBackup"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">D√≠as de Retenci√≥n</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.backup!.diasRetencionBackup"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Backups M√°ximos a Almacenar</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.backup!.backupsMaximosAlmacenar"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="form-label">Ruta de Backup Local</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.backup!.rutaBackupLocal"
              (input)="detectarCambios()"
              placeholder="C:\Backups\Planillas"
            />
          </div>
        </div>

        <div class="opciones-grid">
          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.backup!.backupAutomatico"
              (change)="detectarCambios()"
            />
            <span>Backup autom√°tico activo</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.backup!.comprimirBackups"
              (change)="detectarCambios()"
            />
            <span>Comprimir backups</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.backup!.encriptarBackups"
              (change)="detectarCambios()"
            />
            <span>Encriptar backups</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.backup!.notificarBackupExitoso"
              (change)="detectarCambios()"
            />
            <span>Notificar backup exitoso</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.backup!.notificarBackupFallido"
              (change)="detectarCambios()"
            />
            <span>Notificar backup fallido</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.backup!.permitirRestauracion"
              (change)="detectarCambios()"
            />
            <span>Permitir restauraci√≥n de backups</span>
          </label>
        </div>
      </div>

      <div class="acciones-backup">
        <button class="btn btn--primary" (click)="ejecutarBackupManual()">
          üíæ Crear Backup Ahora
        </button>
        <button class="btn btn--outline" (click)="restaurarBackup()">
          ‚Ü©Ô∏è Restaurar Backup
        </button>
      </div>
    </div>

    <!-- ==================== TAB: SISTEMA ==================== -->
    <div class="tab-panel" *ngIf="tabActiva === 'sistema'">
      <h2 class="section-title">‚öôÔ∏è Configuraci√≥n del Sistema</h2>

      <div class="info-sistema">
        <div class="info-item">
          <span class="info-label">Versi√≥n del Sistema:</span>
          <span class="info-value">{{ configuracion.sistema!.versionSistema }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">√öltima Actualizaci√≥n:</span>
          <span class="info-value">{{ configuracion.sistema?.fechaActualizacion ? formatearFecha(configuracion.sistema.fechaActualizacion) : 'No disponible' }}</span>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">‚ö° Performance y L√≠mites</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Registros por P√°gina</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.sistema!.registrosPorPagina"
              (input)="detectarCambios()"
              min="5"
              max="100"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Tama√±o M√°ximo Archivo (MB)</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.sistema!.tamanioMaximoArchivo"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Tiempo de Cach√© (segundos)</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.sistema!.tiempoCache"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Trabajadores M√°ximos</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.sistema!.trabajadoresMaximos"
              (input)="detectarCambios()"
            />
          </div>
        </div>

        <div class="opciones-grid">
          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.sistema!.cacheDatos"
              (change)="detectarCambios()"
            />
            <span>Cach√© de datos activo</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.sistema!.optimizarConsultas"
              (change)="detectarCambios()"
            />
            <span>Optimizar consultas autom√°ticamente</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.sistema!.optimizarDBAutomatico"
              (change)="detectarCambios()"
            />
            <span>Optimizar base de datos autom√°ticamente</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.sistema!.verificarActualizacionesAuto"
              (change)="detectarCambios()"
            />
            <span>Verificar actualizaciones autom√°ticamente</span>
          </label>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üìã Logs</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Nivel de Logs</label>
            <select class="form-select" [(ngModel)]="configuracion.sistema!.nivelLogs" (change)="detectarCambios()">
              <option value="error">Error</option>
              <option value="warning">Warning</option>
              <option value="info">Info</option>
              <option value="debug">Debug</option>
            </select>
          </div>

          <div class="form-group form-group--full">
            <label class="form-label">Ruta de Logs</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.sistema!.rutaLogs"
              (input)="detectarCambios()"
              placeholder="C:\Logs\Planillas"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.sistema!.guardarLogsEnArchivo"
                (change)="detectarCambios()"
              />
              <span>Guardar logs en archivo</span>
            </label>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üîß API</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">API Key</label>
            <div class="input-group">
              <input
                type="text"
                class="form-input"
                [(ngModel)]="configuracion.sistema!.apiKey"
                (input)="detectarCambios()"
                readonly
              />
              <button class="btn btn--outline" (click)="generarAPIKey()">
                üîë Generar
              </button>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Rate Limit (req/min)</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="configuracion.sistema!.rateLimitAPI"
              (input)="detectarCambios()"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.sistema!.apiHabilitada"
                (change)="detectarCambios()"
              />
              <span>API habilitada</span>
            </label>
          </div>
        </div>
      </div>

      <div class="acciones-sistema">
        <button class="btn btn--outline" (click)="limpiarCache()">
          üóëÔ∏è Limpiar Cach√©
        </button>
        <button class="btn btn--outline" (click)="optimizarBaseDatos()">
          ‚ö° Optimizar Base de Datos
        </button>
        <button class="btn btn--outline" (click)="verificarActualizaciones()">
          üîÑ Verificar Actualizaciones
        </button>
      </div>
    </div>

    <!-- ==================== TAB: INTEGRACIONES ==================== -->
    <div class="tab-panel" *ngIf="tabActiva === 'integraciones'">
      <h2 class="section-title">üîó Integraciones</h2>

      <div class="form-section">
        <h3 class="form-section__title">üè¶ Bancos</h3>
        <div class="opciones-grid">
          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.integraciones!.integrarBancoNacion"
              (change)="detectarCambios()"
            />
            <span>Banco de la Naci√≥n</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.integraciones!.integrarBCP"
              (change)="detectarCambios()"
            />
            <span>BCP</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.integraciones!.integrarInterbank"
              (change)="detectarCambios()"
            />
            <span>Interbank</span>
          </label>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üèõÔ∏è Gobierno</h3>
        <div class="opciones-grid">
          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.integraciones!.integrarSUNAT"
              (change)="detectarCambios()"
            />
            <span>SUNAT</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.integraciones!.integrarEsSalud"
              (change)="detectarCambios()"
            />
            <span>EsSalud</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.integraciones!.integrarRENIEC"
              (change)="detectarCambios()"
            />
            <span>RENIEC</span>
          </label>

          <label class="opcion-check">
            <input
              type="checkbox"
              [(ngModel)]="configuracion.integraciones!.integrarAFP"
              (change)="detectarCambios()"
            />
            <span>AFP</span>
          </label>
        </div>
      </div>

      <div class="form-section">
        <h3 class="form-section__title">üñ•Ô∏è Biom√©trico</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Modelo de Dispositivo</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.integraciones!.modeloBiometrico"
              (input)="detectarCambios()"
              placeholder="ZKTeco K40"
            />
          </div>

          <div class="form-group">
            <label class="form-label">IP del Dispositivo</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="configuracion.integraciones!.ipBiometrico"
              (input)="detectarCambios()"
              placeholder="192.168.1.100"
            />
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="configuracion.integraciones!.integrarBiometrico"
                (change)="detectarCambios()"
              />
              <span>Integrar con dispositivo biom√©trico</span>
            </label>
          </div>

          <div class="form-group form-group--full">
            <button class="btn btn--outline" (click)="probarIntegracion('Biom√©trico')">
              üîß Probar Conexi√≥n
            </button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- FOOTER ACCIONES -->
  <div class="config-footer">
    <div class="config-footer__info">
      <span class="info-text">√öltima modificaci√≥n: {{ configuracion.sistema?.fechaActualizacion ? formatearFecha(configuracion.sistema.fechaActualizacion) : 'No disponible' }}</span>
    </div>
    <div class="config-footer__acciones">
      <button class="btn btn--ghost" (click)="cancelarCambios()">
        Cancelar
      </button>
      <button class="btn btn--outline" (click)="exportarConfiguracion()">
        üì§ Exportar
      </button>
    </div>
  </div>

  <!-- LOADING OVERLAY -->
  <div class="loading-overlay" *ngIf="cargando">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>Cargando configuraci√≥n...</p>
    </div>
  </div>

  <!-- MODAL EDITAR/CREAR TASA -->
  <div class="modal-overlay" *ngIf="mostrarModalTasa" (click)="cerrarModalTasa()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ tasaEditando?.ConfigID ? 'Editar Tasa' : 'Nueva Tasa' }}</h3>
        <button class="btn-close" (click)="cerrarModalTasa()">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="form-grid">
          
          <!-- CATEGOR√çA (movido arriba para control din√°mico) -->
          <div class="form-group form-group--full">
            <label class="form-label">Categor√≠a *</label>
            
            <!-- SELECTOR DE CATEGOR√çA CON OPCI√ìN PERSONALIZADA -->
            <div class="categoria-selector">
              <select 
                class="form-select" 
                [(ngModel)]="tasaEditando.Categoria" 
                (change)="onCategoriaChange($event)"
                [class.form-select--custom]="categoriaEsPersonalizada">
                <!-- OPCI√ìN PARA CREAR NUEVA CATEGOR√çA -->
                <option value="__NUEVA_CATEGORIA__">‚ûï Crear Nueva Categor√≠a...</option>
                
                <!-- PENSIONES -->
                <option value="AFP - Fondo de Pensiones">AFP - Fondo de Pensiones</option>
                <option value="ONP - Sistema de Pensiones">ONP - Sistema de Pensiones</option>
                
                <!-- SALUD Y SEGUROS -->
                <option value="Salud">Salud (EsSalud)</option>
                <option value="SEGUROS">Seguros</option>
                <option value="SCTR">SCTR - Seguro Complementario</option>
                
                <!-- TRIBUTARIO -->
                <option value="Renta de 5ta Categor√≠a">Renta de 5ta Categor√≠a</option>
                <option value="Renta">Renta</option>
                
                <!-- INGRESOS Y BONIFICACIONES -->
                <option value="Bonificaciones">Bonificaciones</option>
                <option value="BONIFICACIONES">Bonificaciones (Sistema)</option>
                <option value="INGRESOS">Ingresos</option>
                <option value="Asignaci√≥n Familiar">Asignaci√≥n Familiar</option>
                
                <!-- DESCUENTOS -->
                <option value="Descuentos por Asistencia">Descuentos por Asistencia</option>
                <option value="DESCUENTOS">Descuentos</option>
                <option value="SINDICAL">Sindical</option>
                <option value="PRESTAMOS">Pr√©stamos</option>
                <option value="APORTES">Aportes</option>
                
                <!-- OTROS -->
                <option value="Otros">Otros - Conceptos Generales</option>
                <option value="OTROS_DESCUENTOS">Otros Descuentos</option>
              </select>
              
              <!-- INPUT PARA CATEGOR√çA PERSONALIZADA -->
              <div class="categoria-personalizada" *ngIf="categoriaEsPersonalizada">
                <input 
                  type="text" 
                  class="form-input" 
                  [(ngModel)]="nuevaCategoria" 
                  (input)="onNuevaCategoriaChange()"
                  placeholder="Escriba el nombre de la nueva categor√≠a..."
                  maxlength="50">
                <small class="form-hint">üí° Escriba el nombre de la nueva categor√≠a (se convertir√° autom√°ticamente a may√∫sculas)</small>
              </div>
            </div>
            
            <small class="form-hint">üí° La categor√≠a determina el prefijo del c√≥digo</small>
          </div>

          <!-- TIPO DE TASA -->
          <div class="form-group form-group--full">
            <label class="form-label">Tipo de Tasa <span style="color: #888; font-size: 0.9em;">(Opcional)</span></label>
            <select 
              class="form-select" 
              [(ngModel)]="tasaEditando.TipoTasa"
              (change)="onTipoTasaChange()">
              <option value="">-- Seleccionar tipo (o dejar en blanco para detecci√≥n autom√°tica) --</option>
              <option value="DESCUENTO">‚ûñ Descuento (Se resta del sueldo del trabajador)</option>
              <option value="INGRESO">‚ûï Ingreso (Se suma al sueldo del trabajador)</option>
              <option value="APORTE_EMPLEADOR">üè¢ Aporte del Empleador (Costo para la empresa, no afecta el sueldo)</option>
            </select>
            <small class="form-hint">
              üí° <strong>Opcional:</strong> Si no seleccionas, el sistema detectar√° autom√°ticamente el tipo seg√∫n el nombre, categor√≠a o c√≥digo de la tasa.
              <br>
              <strong>Palabras clave para detecci√≥n autom√°tica:</strong>
              <br>
              ‚Ä¢ <strong>Descuento:</strong> "descuento", "cuota", "retenci√≥n", "pr√©stamo", "sindical", "falta", "tardanza"
              <br>
              ‚Ä¢ <strong>Ingreso:</strong> "bono", "bonificaci√≥n", "compensaci√≥n", "premio", "gratificaci√≥n", "extra"
              <br>
              ‚Ä¢ <strong>Aporte:</strong> "aporte", "essalud", "sctr", "seguro vida", "empleador"
            </small>
          </div>

          <!-- SELECTOR DE CARGO (solo para Renta 5ta y nuevo) -->
          <div class="form-group form-group--full" *ngIf="!tasaEditando.ConfigID && esCategoriaRenta()">
            <label class="form-label">üí° Atajo R√°pido: Seleccionar Cargo</label>
            <select 
              class="form-select" 
              [(ngModel)]="cargoSeleccionado"
              (change)="onCargoSeleccionado()"
            >
              <option value="">-- Seleccionar cargo para Renta 5ta --</option>
              <option *ngFor="let cargo of cargosDisponibles" [value]="cargo.nombre || cargo.NombreCargo">
                {{ cargo.nombre || cargo.NombreCargo }}
              </option>
            </select>
            <small class="form-hint">Selecciona un cargo y se llenar√° autom√°ticamente el c√≥digo, nombre y descripci√≥n</small>
          </div>

          <div class="form-group form-group--full">
            <label class="form-label">Nombre de la Tasa *</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="tasaEditando.Nombre"
              (ngModelChange)="generarCodigoTasa()"
              placeholder="Ej: Descuento por Tardanza Leve"
            />
            <small class="form-hint">üí° Escribe el nombre y el c√≥digo se generar√° autom√°ticamente</small>
          </div>

          <div class="form-group form-group--full">
            <label class="form-label">C√≥digo (Generado Autom√°ticamente)</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="tasaEditando.Codigo"
              placeholder="Se generar√° autom√°ticamente..."
              [disabled]="true"
              style="background-color: #f5f5f5; color: #666; text-transform: uppercase; font-family: monospace;"
            />
            <small class="form-hint">‚úÖ El c√≥digo se genera autom√°ticamente seg√∫n la categor√≠a y el nombre</small>
          </div>

          <div class="form-group">
            <label class="form-label">Valor *</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="tasaEditando.Valor"
              step="0.0001"
            />
            <small class="form-hint">Para porcentajes usa decimal (ej: 0.1137 = 11.37%)</small>
          </div>

          <div class="form-group">
            <label class="form-label">Tipo *</label>
            <select class="form-select" [(ngModel)]="tasaEditando.TipoValor">
              <option value="Porcentaje">Porcentaje</option>
              <option value="Monto">Monto</option>
              <option value="Factor">Factor</option>
              <option value="Cantidad">Cantidad</option>
            </select>
          </div>

          <div class="form-group form-group--full">
            <label class="form-label">Descripci√≥n</label>
            <textarea
              class="form-input"
              [(ngModel)]="tasaEditando.Descripcion"
              rows="3"
              placeholder="Descripci√≥n de la tasa..."
            ></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">Fecha Vigencia Inicio *</label>
            <input
              type="date"
              class="form-input"
              [(ngModel)]="tasaEditando.FechaVigenciaInicio"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Fecha Vigencia Fin</label>
            <input
              type="date"
              class="form-input"
              [(ngModel)]="tasaEditando.FechaVigenciaFin"
            />
            <small class="form-hint">Dejar vac√≠o para vigencia indefinida</small>
          </div>

          <div class="form-group form-group--full">
            <label class="opcion-check">
              <input
                type="checkbox"
                [(ngModel)]="tasaEditando.Activo"
              />
              <span>Activo</span>
            </label>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn--secondary" (click)="cerrarModalTasa()">
          ‚úï Cancelar
        </button>
        <button class="btn btn--primary" (click)="guardarTasa()" [disabled]="guardando">
          {{ guardando ? '‚è≥ Guardando...' : 'üíæ Guardar Tasa' }}
        </button>
      </div>
    </div>
  </div>

  <!-- MODAL ELIMINAR/DESACTIVAR TASA -->
  <div class="modal-overlay" *ngIf="mostrarModalEliminarTasa" (click)="cerrarModalEliminarTasa()">
    <div class="modal-content modal-content--small" (click)="$event.stopPropagation()">
      <div class="modal-header" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);">
        <h3 style="color: white;">‚ö†Ô∏è Eliminar o Desactivar Tasa</h3>
        <button class="btn-close" (click)="cerrarModalEliminarTasa()" style="color: white;">‚úï</button>
      </div>

      <div class="modal-body" style="padding: 2rem;">
        <div class="alert alert--warning" style="margin-bottom: 1.5rem;">
          <div class="alert__icon">‚ö†Ô∏è</div>
          <div class="alert__content">
            <strong>¬øQu√© deseas hacer con esta tasa?</strong>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">
              <strong>{{ tasaAEliminar?.Nombre }}</strong><br>
              <code style="background: #fff; padding: 0.35rem 0.75rem; border-radius: 4px; color: #000; font-weight: 700; border: 2px solid #ffc107; display: inline-block; margin-top: 0.25rem; font-size: 0.95rem;">{{ tasaAEliminar?.Codigo }}</code>
            </p>
          </div>
        </div>

        <div style="display: grid; gap: 1rem; margin-bottom: 1.5rem;">
          <!-- Opci√≥n 1: Desactivar -->
          <div class="opcion-card" style="border: 2px solid #ffa500; border-radius: 8px; padding: 1rem; background: #fff8f0;">
            <h4 style="margin: 0 0 0.5rem 0; color: #ff8c00; display: flex; align-items: center; gap: 0.5rem;">
              <span style="font-size: 1.5rem;">üëÅÔ∏è‚Äçüó®Ô∏è</span>
              Marcar como Inactiva (Recomendado)
            </h4>
            <ul style="margin: 0; padding-left: 1.5rem; font-size: 0.9rem; color: #666;">
              <li>‚úÖ La tasa se conserva en el historial</li>
              <li>‚úÖ No se usar√° en futuros c√°lculos</li>
              <li>‚úÖ Se puede reactivar despu√©s</li>
              <li>‚úÖ Las planillas antiguas mantienen la referencia</li>
            </ul>
          </div>

          <!-- Opci√≥n 2: Eliminar -->
          <div class="opcion-card" style="border: 2px solid #dc3545; border-radius: 8px; padding: 1rem; background: #fff5f5;">
            <h4 style="margin: 0 0 0.5rem 0; color: #dc3545; display: flex; align-items: center; gap: 0.5rem;">
              <span style="font-size: 1.5rem;">üóëÔ∏è</span>
              Eliminar Definitivamente
            </h4>
            <ul style="margin: 0; padding-left: 1.5rem; font-size: 0.9rem; color: #666;">
              <li>‚ùå La tasa se borra permanentemente</li>
              <li>‚ùå No se puede recuperar</li>
              <li>‚ö†Ô∏è Puede afectar reportes hist√≥ricos</li>
              <li>‚ö†Ô∏è Solo usar si fue creada por error</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="modal-footer" style="display: flex; gap: 0.75rem; justify-content: space-between;">
        <button class="btn btn--ghost" (click)="cerrarModalEliminarTasa()" style="flex: 1;">
          ‚úï Cancelar
        </button>
        <button 
          class="btn btn--warning" 
          (click)="desactivarTasa()" 
          [disabled]="guardando"
          style="flex: 1; background: #ffa500; border-color: #ffa500;"
        >
          {{ guardando ? '‚è≥ Procesando...' : 'üëÅÔ∏è‚Äçüó®Ô∏è Desactivar' }}
        </button>
        <button 
          class="btn btn--danger" 
          (click)="eliminarTasaDefinitivamente()" 
          [disabled]="guardando"
          style="flex: 1;"
        >
          {{ guardando ? '‚è≥ Procesando...' : 'üóëÔ∏è Eliminar' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- INPUT FILE OCULTO PARA IMPORTAR -->
<input
  type="file"
  #fileInput
  accept=".json"
  style="display: none"
  (change)="importarConfiguracion($event)"
/>

<!-- MODAL PARA REG√çMENES LABORALES -->
<div class="modal-overlay" *ngIf="mostrarModalRegimenLaboral" (click)="cerrarModalRegimenLaboral()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ regimenLaboralEditando?.RegimenID ? 'Editar R√©gimen Laboral' : 'Nuevo R√©gimen Laboral' }}</h3>
      <button class="btn btn--ghost btn--sm" (click)="cerrarModalRegimenLaboral()">
        ‚úï
      </button>
    </div>

    <div class="modal-body">
      <div class="form-grid">
        
        <!-- C√ìDIGO -->
        <div class="form-group">
          <label class="form-label">C√≥digo *</label>
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="regimenLaboralForm.codigo"
            placeholder="Ej: CARGO-POLITICO"
            maxlength="20"
            required>
          <small class="form-help">M√°ximo 20 caracteres. Se genera autom√°ticamente si se deja vac√≠o.</small>
        </div>

        <!-- NOMBRE -->
        <div class="form-group">
          <label class="form-label">Nombre *</label>
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="regimenLaboralForm.nombre"
            placeholder="Ej: Cargo Pol√≠tico"
            maxlength="100"
            required>
        </div>

        <!-- DESCRIPCI√ìN -->
        <div class="form-group form-group--full">
          <label class="form-label">Descripci√≥n *</label>
          <textarea 
            class="form-textarea" 
            [(ngModel)]="regimenLaboralForm.descripcion"
            placeholder="Descripci√≥n detallada del r√©gimen laboral..."
            rows="3"
            maxlength="255"
            required></textarea>
        </div>

        <!-- BASE NORMATIVA -->
        <div class="form-group form-group--full">
          <label class="form-label">Base Normativa *</label>
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="regimenLaboralForm.baseNormativa"
            placeholder="Ej: Ley General del Trabajo"
            maxlength="100"
            required>
        </div>

      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn--ghost" (click)="cerrarModalRegimenLaboral()">
        ‚úï Cancelar
      </button>
      <button class="btn btn--primary" (click)="guardarRegimenLaboral()" [disabled]="guardandoRegimenLaboral">
        {{ guardandoRegimenLaboral ? '‚è≥ Guardando...' : 'üíæ Guardar R√©gimen' }}
      </button>
    </div>
  </div>
</div>

<!-- MODAL CREAR/EDITAR TIPO DE CONTRATO -->
<div class="modal-overlay" *ngIf="mostrarModalTipoContrato" (click)="cerrarModalTipoContrato()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ tipoContratoEditando?.TipoContratoID ? 'Editar Tipo de Contrato' : 'Nuevo Tipo de Contrato' }}</h3>
      <button class="btn btn--ghost btn--sm" (click)="cerrarModalTipoContrato()">
        ‚úï
      </button>
    </div>

    <div class="modal-body">
      <div class="form-grid">
        
        <!-- C√ìDIGO -->
        <div class="form-group">
          <label class="form-label">C√≥digo *</label>
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="tipoContratoForm.codigo"
            placeholder="Ej: CAS-TEMP"
            maxlength="20"
            required>
          <small class="form-help">M√°ximo 20 caracteres. Se genera autom√°ticamente si se deja vac√≠o.</small>
        </div>

        <!-- NOMBRE -->
        <div class="form-group">
          <label class="form-label">Nombre *</label>
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="tipoContratoForm.nombre"
            placeholder="Ej: CAS Temporal"
            maxlength="100"
            required>
        </div>

        <!-- DESCRIPCI√ìN -->
        <div class="form-group form-group--full">
          <label class="form-label">Descripci√≥n</label>
          <textarea 
            class="form-textarea" 
            [(ngModel)]="tipoContratoForm.descripcion"
            placeholder="Descripci√≥n detallada del tipo de contrato..."
            rows="3"
            maxlength="255"></textarea>
        </div>

      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn--ghost" (click)="cerrarModalTipoContrato()">
        ‚úï Cancelar
      </button>
      <button class="btn btn--primary" (click)="guardarTipoContrato()" [disabled]="guardandoTipoContrato">
        {{ guardandoTipoContrato ? '‚è≥ Guardando...' : 'üíæ Guardar Tipo de Contrato' }}
      </button>
    </div>
  </div>
</div>

<!-- MODAL CREAR/EDITAR CONDICI√ìN LABORAL -->
<div class="modal-overlay" *ngIf="mostrarModalCondicionLaboral" (click)="cerrarModalCondicionLaboral()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ condicionLaboralEditando?.CondicionID ? 'Editar Condici√≥n Laboral' : 'Nueva Condici√≥n Laboral' }}</h3>
      <button class="btn btn--ghost btn--sm" (click)="cerrarModalCondicionLaboral()">
        ‚úï
      </button>
    </div>

    <div class="modal-body">
      <div class="form-grid">
        
        <!-- C√ìDIGO -->
        <div class="form-group">
          <label class="form-label">C√≥digo *</label>
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="condicionLaboralForm.codigo"
            placeholder="Ej: NOMBRADO"
            maxlength="50"
            required>
          <small class="form-help">M√°ximo 50 caracteres. Ejemplos: NOMBRADO, CONTRATADO, EMPLEADO_CONFIANZA</small>
        </div>

        <!-- NOMBRE -->
        <div class="form-group">
          <label class="form-label">Nombre *</label>
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="condicionLaboralForm.nombre"
            placeholder="Ej: Nombrado"
            maxlength="200"
            required>
        </div>

        <!-- DESCRIPCI√ìN -->
        <div class="form-group form-group--full">
          <label class="form-label">Descripci√≥n</label>
          <textarea
            class="form-textarea"
            [(ngModel)]="condicionLaboralForm.descripcion"
            placeholder="Descripci√≥n de la condici√≥n laboral..."
            rows="3"
            maxlength="500">
          </textarea>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button 
        class="btn btn--outline" 
        (click)="cerrarModalCondicionLaboral()"
        [disabled]="guardandoCondicionLaboral">
        Cancelar
      </button>
      <button 
        class="btn btn--primary" 
        (click)="guardarCondicionLaboral()"
        [disabled]="guardandoCondicionLaboral || !condicionLaboralForm.nombre?.trim() || !condicionLaboralForm.codigo?.trim()">
        {{ guardandoCondicionLaboral ? 'Guardando...' : (condicionLaboralEditando ? 'Actualizar Condici√≥n' : 'Guardar Condici√≥n Laboral') }}
      </button>
    </div>
  </div>
</div>

<!-- MODAL CREAR/EDITAR CARGO -->
<div class="modal-overlay" *ngIf="mostrarModalCargo" (click)="cerrarModalCargo()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ cargoEditando?.CargoID ? 'Editar Cargo' : 'Nuevo Cargo' }}</h3>
      <button class="btn btn--ghost btn--sm" (click)="cerrarModalCargo()">
        ‚úï
      </button>
    </div>

    <div class="modal-body">
      <div class="form-grid">
        
        <!-- NOMBRE -->
        <div class="form-group form-group--full">
          <label class="form-label">Nombre *</label>
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="cargoForm.nombre"
            placeholder="Ej: Jefe de Recursos Humanos"
            maxlength="100"
            required>
        </div>

        <!-- DESCRIPCI√ìN -->
        <div class="form-group form-group--full">
          <label class="form-label">Descripci√≥n</label>
          <textarea 
            class="form-textarea" 
            [(ngModel)]="cargoForm.descripcion"
            placeholder="Descripci√≥n detallada del cargo..."
            rows="3"
            maxlength="255"></textarea>
        </div>

      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn--ghost" (click)="cerrarModalCargo()">
        ‚úï Cancelar
      </button>
      <button class="btn btn--primary" (click)="guardarCargo()" [disabled]="guardandoCargo">
        {{ guardandoCargo ? '‚è≥ Guardando...' : 'üíæ Guardar Cargo' }}
      </button>
    </div>
  </div>
</div>

<!-- MODAL CREAR/EDITAR ROL -->
<div class="modal-overlay" *ngIf="mostrarModalRol" (click)="cerrarModalRol()">
  <div class="modal-content modal-content--large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ rolEditando ? '‚úèÔ∏è Editar Rol' : '‚ûï Crear Nuevo Rol' }}</h3>
      <button class="btn-close" (click)="cerrarModalRol()">‚úï</button>
    </div>

    <div class="modal-body">
      <div class="form-grid">
        <!-- Nombre del rol -->
        <div class="form-group">
          <label class="form-label">Nombre del Rol *</label>
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="rolForm.nombre"
            placeholder="Ej: Supervisor, Editor, etc."
            required>
        </div>

        <!-- Descripci√≥n -->
        <div class="form-group form-group--full">
          <label class="form-label">Descripci√≥n</label>
          <textarea 
            class="form-textarea" 
            [(ngModel)]="rolForm.descripcion"
            placeholder="Describe las responsabilidades de este rol..."
            rows="3"></textarea>
        </div>
      </div>

      <!-- PERMISOS -->
      <div class="permisos-section">
        <h4 class="permisos-title">üîê Configurar Permisos</h4>
        <p class="permisos-description">Selecciona los permisos que tendr√° este rol en cada m√≥dulo del sistema</p>

        <div class="permisos-container">
          <!-- TRABAJADORES -->
          <div class="permiso-modulo">
            <div class="permiso-modulo__header">
              <span class="permiso-modulo__icon">üë•</span>
              <span class="permiso-modulo__nombre">Trabajadores</span>
            </div>
            <div class="permiso-modulo__opciones">
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('trabajadores', 'ver')"
                       (change)="togglePermiso('trabajadores', 'ver')">
                <span class="checkmark"></span>
                Ver trabajadores
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('trabajadores', 'crear')"
                       (change)="togglePermiso('trabajadores', 'crear')">
                <span class="checkmark"></span>
                Crear trabajadores
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('trabajadores', 'editar')"
                       (change)="togglePermiso('trabajadores', 'editar')">
                <span class="checkmark"></span>
                Editar trabajadores
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('trabajadores', 'eliminar')"
                       (change)="togglePermiso('trabajadores', 'eliminar')">
                <span class="checkmark"></span>
                Eliminar trabajadores
              </label>
            </div>
          </div>

          <!-- PLANILLAS -->
          <div class="permiso-modulo">
            <div class="permiso-modulo__header">
              <span class="permiso-modulo__icon">üí∞</span>
              <span class="permiso-modulo__nombre">Planillas</span>
            </div>
            <div class="permiso-modulo__opciones">
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('planillas', 'ver')"
                       (change)="togglePermiso('planillas', 'ver')">
                <span class="checkmark"></span>
                Ver planillas
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('planillas', 'crear')"
                       (change)="togglePermiso('planillas', 'crear')">
                <span class="checkmark"></span>
                Crear planillas
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('planillas', 'editar')"
                       (change)="togglePermiso('planillas', 'editar')">
                <span class="checkmark"></span>
                Editar planillas
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('planillas', 'eliminar')"
                       (change)="togglePermiso('planillas', 'eliminar')">
                <span class="checkmark"></span>
                Eliminar planillas
              </label>
            </div>
          </div>

          <!-- REPORTES -->
          <div class="permiso-modulo">
            <div class="permiso-modulo__header">
              <span class="permiso-modulo__icon">üìä</span>
              <span class="permiso-modulo__nombre">Reportes</span>
            </div>
            <div class="permiso-modulo__opciones">
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('reportes', 'ver')"
                       (change)="togglePermiso('reportes', 'ver')">
                <span class="checkmark"></span>
                Ver reportes
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('reportes', 'exportar')"
                       (change)="togglePermiso('reportes', 'exportar')">
                <span class="checkmark"></span>
                Exportar reportes
              </label>
            </div>
          </div>

          <!-- CONFIGURACI√ìN -->
          <div class="permiso-modulo">
            <div class="permiso-modulo__header">
              <span class="permiso-modulo__icon">‚öôÔ∏è</span>
              <span class="permiso-modulo__nombre">Configuraci√≥n</span>
            </div>
            <div class="permiso-modulo__opciones">
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('configuracion', 'ver')"
                       (change)="togglePermiso('configuracion', 'ver')">
                <span class="checkmark"></span>
                Ver configuraci√≥n
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('configuracion', 'editar')"
                       (change)="togglePermiso('configuracion', 'editar')">
                <span class="checkmark"></span>
                Editar configuraci√≥n
              </label>
            </div>
          </div>

          <!-- ASISTENCIA -->
          <div class="permiso-modulo">
            <div class="permiso-modulo__header">
              <span class="permiso-modulo__icon">üìÖ</span>
              <span class="permiso-modulo__nombre">Asistencia</span>
            </div>
            <div class="permiso-modulo__opciones">
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('asistencia', 'ver')"
                       (change)="togglePermiso('asistencia', 'ver')">
                <span class="checkmark"></span>
                Ver asistencia
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('asistencia', 'editar')"
                       (change)="togglePermiso('asistencia', 'editar')">
                <span class="checkmark"></span>
                Editar asistencia
              </label>
            </div>
          </div>

          <!-- BENEFICIOS -->
          <div class="permiso-modulo">
            <div class="permiso-modulo__header">
              <span class="permiso-modulo__icon">üéÅ</span>
              <span class="permiso-modulo__nombre">Beneficios</span>
            </div>
            <div class="permiso-modulo__opciones">
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('beneficios', 'ver')"
                       (change)="togglePermiso('beneficios', 'ver')">
                <span class="checkmark"></span>
                Ver beneficios
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('beneficios', 'editar')"
                       (change)="togglePermiso('beneficios', 'editar')">
                <span class="checkmark"></span>
                Editar beneficios
              </label>
            </div>
          </div>

          <!-- PR√âSTAMOS -->
          <div class="permiso-modulo">
            <div class="permiso-modulo__header">
              <span class="permiso-modulo__icon">üíµ</span>
              <span class="permiso-modulo__nombre">Pr√©stamos</span>
            </div>
            <div class="permiso-modulo__opciones">
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('prestamos', 'ver')"
                       (change)="togglePermiso('prestamos', 'ver')">
                <span class="checkmark"></span>
                Ver pr√©stamos
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('prestamos', 'crear')"
                       (change)="togglePermiso('prestamos', 'crear')">
                <span class="checkmark"></span>
                Crear pr√©stamos
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('prestamos', 'editar')"
                       (change)="togglePermiso('prestamos', 'editar')">
                <span class="checkmark"></span>
                Editar pr√©stamos
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('prestamos', 'eliminar')"
                       (change)="togglePermiso('prestamos', 'eliminar')">
                <span class="checkmark"></span>
                Eliminar pr√©stamos
              </label>
            </div>
          </div>

          <!-- USUARIOS -->
          <div class="permiso-modulo">
            <div class="permiso-modulo__header">
              <span class="permiso-modulo__icon">üë§</span>
              <span class="permiso-modulo__nombre">Usuarios</span>
            </div>
            <div class="permiso-modulo__opciones">
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('usuarios', 'ver')"
                       (change)="togglePermiso('usuarios', 'ver')">
                <span class="checkmark"></span>
                Ver usuarios
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('usuarios', 'crear')"
                       (change)="togglePermiso('usuarios', 'crear')">
                <span class="checkmark"></span>
                Crear usuarios
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('usuarios', 'editar')"
                       (change)="togglePermiso('usuarios', 'editar')">
                <span class="checkmark"></span>
                Editar usuarios
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('usuarios', 'eliminar')"
                       (change)="togglePermiso('usuarios', 'eliminar')">
                <span class="checkmark"></span>
                Eliminar usuarios
              </label>
            </div>
          </div>

          <!-- ROLES -->
          <div class="permiso-modulo">
            <div class="permiso-modulo__header">
              <span class="permiso-modulo__icon">üëë</span>
              <span class="permiso-modulo__nombre">Roles</span>
            </div>
            <div class="permiso-modulo__opciones">
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('roles', 'ver')"
                       (change)="togglePermiso('roles', 'ver')">
                <span class="checkmark"></span>
                Ver roles
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('roles', 'crear')"
                       (change)="togglePermiso('roles', 'crear')">
                <span class="checkmark"></span>
                Crear roles
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('roles', 'editar')"
                       (change)="togglePermiso('roles', 'editar')">
                <span class="checkmark"></span>
                Editar roles
              </label>
              <label class="permiso-checkbox">
                <input type="checkbox" 
                       [checked]="tienePermiso('roles', 'eliminar')"
                       (change)="togglePermiso('roles', 'eliminar')">
                <span class="checkmark"></span>
                Eliminar roles
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn--ghost" (click)="cerrarModalRol()">
        ‚úï Cancelar
      </button>
      <button class="btn btn--primary" (click)="guardarRol()" [disabled]="guardandoRol">
        {{ guardandoRol ? '‚è≥ Guardando...' : 'üíæ Guardar Rol' }}
      </button>
    </div>
  </div>
</div>

<!-- MODAL: √âXITO CREACI√ìN/ACTUALIZACI√ìN ROL -->
<div class="modal-overlay modal--exito" *ngIf="mostrarModalExitoRol" (click)="cerrarModalExitoRol()">
  <div class="modal-content modal-content--exito" (click)="$event.stopPropagation()">
    <div class="exito-rol">
      <!-- C√≠rculo de carga -->
      <div class="exito-rol__loader" *ngIf="guardandoRolProceso">
        <div class="spinner spinner--success"></div>
      </div>
      
      <!-- Check de √©xito -->
      <div class="exito-rol__check" *ngIf="rolGuardadoCompletado">
        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" width="50" height="50">
          <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
          <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
        </svg>
      </div>
      
      <h3 class="exito-rol__title">Rol guardado exitosamente</h3>
      <p class="exito-rol__message" *ngIf="rolGuardadoCompletado">
        {{ mensajeExitoRol }}
      </p>
      <p class="exito-rol__message" *ngIf="guardandoRolProceso">
        Guardando rol...
      </p>
    </div>
  </div>
</div>

<!-- MODAL: ELIMINAR ROL -->
<div class="modal-overlay" *ngIf="mostrarModalEliminarRol" (click)="cerrarModalEliminarRol()">
  <div class="modal-content modal-content--delete" (click)="$event.stopPropagation()">
    <div class="delete-header">
      <div class="delete-icon">üóëÔ∏è</div>
      <h3>Eliminar Rol Permanentemente</h3>
    </div>
    
    <div class="delete-planilla-info">
      <div class="info-item">
        <span class="info-label">Rol:</span>
        <span class="info-value">{{ rolAEliminar?.nombre }}</span>
      </div>
      <div class="info-item" *ngIf="rolAEliminar?.descripcion">
        <span class="info-label">Descripci√≥n:</span>
        <span class="info-value">{{ rolAEliminar.descripcion }}</span>
      </div>
    </div>
    
    <div class="delete-warning">
      <div class="warning-icon">‚ö†Ô∏è</div>
      <div class="warning-content">
        <p><strong>Esta acci√≥n no se puede deshacer.</strong></p>
        <p>El rol ser√° eliminado permanentemente de la base de datos.</p>
        <p *ngIf="rolAEliminar?.nombre === 'Super Administrador' || getRolDisplayName(rolAEliminar?.nombre) === 'Super Administrador'">
          <strong style="color: #dc2626;">‚ö†Ô∏è ADVERTENCIA: Est√°s eliminando el rol Super Administrador. Aseg√∫rate de que no haya usuarios asignados a este rol.</strong>
        </p>
      </div>
    </div>
    
    <div class="delete-confirmation">
      <label class="form-label">Escriba <strong>ELIMINAR</strong> para confirmar:</label>
      <input 
        type="text" 
        class="form-input" 
        [(ngModel)]="confirmacionEliminarRol"
        placeholder="ELIMINAR"
        (keyup.enter)="confirmarEliminacionRol()"
        autocomplete="off">
    </div>
    
    <div class="delete-actions">
      <button class="btn btn--ghost" (click)="cerrarModalEliminarRol()">
        ‚úï Cancelar
      </button>
      <button 
        class="btn btn--danger" 
        (click)="confirmarEliminacionRol()"
        [disabled]="confirmacionEliminarRol !== 'ELIMINAR' || eliminandoRol">
        {{ eliminandoRol ? '‚è≥ Eliminando...' : 'üóëÔ∏è Eliminar Permanentemente' }}
      </button>
    </div>
  </div>
</div>

<!-- MODAL: √âXITO ELIMINACI√ìN ROL -->
<div class="modal-overlay modal--exito" *ngIf="mostrarModalExitoEliminacionRol" (click)="cerrarModalExitoEliminacionRol()">
  <div class="modal-content modal-content--exito" (click)="$event.stopPropagation()">
    <div class="exito-rol">
      <!-- C√≠rculo de carga -->
      <div class="exito-rol__loader" *ngIf="eliminandoRol">
        <div class="spinner spinner--success"></div>
      </div>
      
      <!-- Check de √©xito -->
      <div class="exito-rol__check" *ngIf="rolEliminadoCompletado">
        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" width="50" height="50">
          <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
          <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
        </svg>
      </div>
      
      <h3 class="exito-rol__title">Rol eliminado exitosamente</h3>
      <p class="exito-rol__message" *ngIf="rolEliminadoCompletado">
        El rol "{{ rolAEliminar?.nombre }}" ha sido eliminado permanentemente de la base de datos.
      </p>
      <p class="exito-rol__message" *ngIf="eliminandoRol">
        Eliminando rol...
      </p>
    </div>
  </div>
</div>

<!-- MODAL CAMBIAR CONTRASE√ëA -->
<div class="modal-overlay" *ngIf="mostrarModalPassword" (click)="cerrarModalPassword()">
  <div class="modal-content modal-content--small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>üîë Cambiar Contrase√±a</h3>
      <button class="btn-close" (click)="cerrarModalPassword()">‚úï</button>
    </div>

    <div class="modal-body">
      <div class="usuario-info-modal">
        <div class="usuario-avatar-modal" [style.background-color]="getColorAvatar({username: passwordForm.usuarioNombre})">
          <span class="avatar-iniciales">{{ passwordForm.usuarioNombre?.substring(0, 2).toUpperCase() }}</span>
          <span class="avatar-icono">üîë</span>
        </div>
        <div class="usuario-details-modal">
          <div class="usuario-nombre-modal">{{ passwordForm.usuarioNombre }}</div>
          <div class="usuario-rol-modal">Usuario del sistema</div>
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group form-group--full">
          <label class="form-label">Contrase√±a Actual *</label>
          <input 
            type="password" 
            class="form-input" 
            [(ngModel)]="passwordForm.passwordActual"
            placeholder="Ingresa la contrase√±a actual"
            required>
        </div>

        <div class="form-group">
          <label class="form-label">Nueva Contrase√±a *</label>
          <input 
            type="password" 
            class="form-input" 
            [(ngModel)]="passwordForm.passwordNuevo"
            placeholder="M√≠nimo 6 caracteres"
            required>
        </div>

        <div class="form-group">
          <label class="form-label">Confirmar Nueva Contrase√±a *</label>
          <input 
            type="password" 
            class="form-input" 
            [(ngModel)]="passwordForm.passwordConfirmar"
            placeholder="Repite la nueva contrase√±a"
            required>
        </div>
      </div>

      <div class="alert alert--info">
        <div class="alert__icon">‚ÑπÔ∏è</div>
        <div class="alert__content">
          <strong>Requisitos de contrase√±a:</strong>
          <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem;">
            <li>M√≠nimo 6 caracteres</li>
            <li>Se recomienda usar una combinaci√≥n de letras y n√∫meros</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn--ghost" (click)="cerrarModalPassword()">
        ‚úï Cancelar
      </button>
      <button class="btn btn--primary" (click)="cambiarPassword()" [disabled]="guardandoPassword">
        {{ guardandoPassword ? '‚è≥ Cambiando...' : 'üîë Cambiar Contrase√±a' }}
      </button>
    </div>
  </div>
</div>

<!-- MODAL EDITAR USUARIO -->
<div class="modal-overlay" *ngIf="mostrarModalEditarUsuario" (click)="cerrarModalEditarUsuario()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>‚úèÔ∏è Editar Usuario</h3>
      <button class="btn-close" (click)="cerrarModalEditarUsuario()">‚úï</button>
    </div>

    <div class="modal-body">
      <div class="usuario-info-modal">
        <div class="usuario-avatar-modal" [style.background-color]="getColorAvatar(usuarioEditando)">
          <span class="avatar-iniciales">{{ getInicialesUsuario(usuarioEditando) }}</span>
          <span class="avatar-icono">{{ getIconoRol(usuarioEditando?.rol) }}</span>
        </div>
        <div class="usuario-details-modal">
          <div class="usuario-nombre-modal">{{ usuarioEditando?.username }}</div>
          <div class="usuario-rol-modal">{{ getRolDisplayName(usuarioEditando?.rol) }}</div>
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">Nombre *</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="usuarioForm.nombre"
            placeholder="Ingrese el nombre"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Apellidos *</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="usuarioForm.apellidos"
            placeholder="Ingrese los apellidos"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input
            type="email"
            class="form-input"
            [(ngModel)]="usuarioForm.email"
            placeholder="usuario@empresa.com"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Nombre de Usuario *</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="usuarioForm.username"
            placeholder="Ej: jperez"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Rol</label>
          <select class="form-select" [(ngModel)]="usuarioForm.rol">
            <option value="">Seleccionar rol...</option>
            <option *ngFor="let rol of roles" [value]="rol.nombre">{{ getRolDisplayName(rol.nombre) }}</option>
          </select>
        </div>
      </div>

      <!-- Configuraci√≥n DEMO (solo visible si es usuario DEMO) -->
      <div class="demo-config-section" *ngIf="usuarioForm.rol === 'DEMO'">
        <div class="demo-section-header">
          <div class="demo-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M12 6v6l4 2"/>
            </svg>
          </div>
          <h4>Configuraci√≥n DEMO</h4>
          <p>Gestiona el tiempo de acceso de esta cuenta DEMO</p>
        </div>

        <div class="demo-fields">
          <div class="form-group">
            <label class="form-label">
              <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 6v6l4 2"/>
              </svg>
              Tiempo de Acceso (horas)
            </label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="usuarioForm.horasDemo"
              (ngModelChange)="onHorasDemoChange()"
              placeholder="Ej: 24, 48, 72..."
              min="1"
              max="720"
            />
            <div class="form-hint">
              Duraci√≥n en horas (1-720 horas m√°ximo)
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">
              <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M8 2v4"/>
                <path d="M16 2v4"/>
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <path d="M3 10h18"/>
              </svg>
              Fecha de Inicio
            </label>
            <input
              type="datetime-local"
              class="form-input"
              [(ngModel)]="usuarioForm.fechaInicioDemo"
              [disabled]="true"
            />
            <div class="form-hint">
              Fecha y hora de inicio del acceso DEMO
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">
              <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M8 2v4"/>
                <path d="M16 2v4"/>
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <path d="M3 10h18"/>
              </svg>
              Fecha de Expiraci√≥n
            </label>
            <input
              type="datetime-local"
              class="form-input"
              [(ngModel)]="usuarioForm.fechaFinDemo"
              [disabled]="true"
            />
            <div class="form-hint">
              Se calcula autom√°ticamente basado en las horas de acceso
            </div>
          </div>

          <div class="demo-status" *ngIf="usuarioForm.fechaFinDemo">
            <div class="status-item">
              <span class="status-label">Estado:</span>
              <span class="status-value" [class.active]="isDemoActive()" [class.expired]="!isDemoActive()">
                {{ isDemoActive() ? 'Activo' : 'Expirado' }}
              </span>
            </div>
            <div class="status-item" *ngIf="isDemoActive()">
              <span class="status-label">Tiempo restante:</span>
              <span class="status-value time-remaining">
                {{ getTiempoRestante() }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn--ghost" (click)="cerrarModalEditarUsuario()">
        Cancelar
      </button>
      <button class="btn btn--primary" (click)="guardarUsuario()" [disabled]="guardandoUsuario">
        <span *ngIf="guardandoUsuario" class="btn__spinner"></span>
        <span *ngIf="!guardandoUsuario">üíæ Guardar Cambios</span>
      </button>
    </div>
  </div>
</div>

<!-- MODAL RESETEAR CONTRASE√ëA (SOLO ADMINISTRADORES) -->
<div class="modal-overlay" *ngIf="mostrarModalResetearPassword" (click)="cerrarModalResetearPassword()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>üîÑ Resetear Contrase√±a</h3>
      <button class="btn-close" (click)="cerrarModalResetearPassword()">‚úï</button>
    </div>

    <div class="modal-body">
      <div class="usuario-info-modal">
        <div class="usuario-avatar-modal" [style.background-color]="getColorAvatar(usuarioReseteando)">
          <span class="avatar-iniciales">{{ getInicialesUsuario(usuarioReseteando) }}</span>
          <span class="avatar-icono">{{ getIconoRol(usuarioReseteando?.rol) }}</span>
        </div>
        <div class="usuario-details-modal">
          <div class="usuario-nombre-modal">{{ usuarioReseteando?.username }}</div>
          <div class="usuario-rol-modal">{{ getRolDisplayName(usuarioReseteando?.rol) }}</div>
        </div>
      </div>

      <div class="warning-box">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <div class="warning-content">
          <h4>Acci√≥n de Administrador</h4>
          <p>Est√°s a punto de resetear la contrase√±a de este usuario. <strong>No necesitas conocer la contrase√±a actual.</strong></p>
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">Nueva Contrase√±a *</label>
          <input
            type="password"
            class="form-input password-input"
            [(ngModel)]="nuevaPassword"
            placeholder="M√≠nimo 6 caracteres"
            autocomplete="new-password"
            data-lpignore="true"
            data-form-type="other"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Confirmar Nueva Contrase√±a *</label>
          <input
            type="password"
            class="form-input password-input"
            [(ngModel)]="confirmarPassword"
            placeholder="Repite la nueva contrase√±a"
            autocomplete="new-password"
            data-lpignore="true"
            data-form-type="other"
          />
        </div>
      </div>

      <div class="password-requirements">
        <h4>Requisitos de contrase√±a:</h4>
        <ul>
          <li>M√≠nimo 6 caracteres</li>
          <li>Se recomienda usar una combinaci√≥n de letras y n√∫meros</li>
          <li>El usuario deber√° cambiar su contrase√±a en el pr√≥ximo inicio de sesi√≥n</li>
        </ul>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn--ghost" (click)="cerrarModalResetearPassword()">
        Cancelar
      </button>
      <button class="btn btn--danger" (click)="resetearPassword()" [disabled]="reseteandoPassword || !nuevaPassword || !confirmarPassword">
        <span *ngIf="reseteandoPassword" class="btn__spinner"></span>
        <span *ngIf="!reseteandoPassword">üîÑ Resetear Contrase√±a</span>
      </button>
    </div>
  </div>
</div>

<!-- MODAL NUEVO USUARIO -->
<div class="modal-overlay" *ngIf="mostrarModalNuevoUsuario" (click)="cerrarModalNuevoUsuario()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>‚ûï Nuevo Usuario</h3>
      <button class="btn-close" (click)="cerrarModalNuevoUsuario()">‚úï</button>
    </div>

    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">Nombre de Usuario *</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="nuevoUsuarioForm.username"
            placeholder="Ej: jperez"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input
            type="email"
            class="form-input"
            [(ngModel)]="nuevoUsuarioForm.email"
            placeholder="usuario@empresa.com (opcional)"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Nombre *</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="nuevoUsuarioForm.nombre"
            placeholder="Juan"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Apellidos *</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="nuevoUsuarioForm.apellidos"
            placeholder="P√©rez Garc√≠a"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Rol *</label>
          <select class="form-select" [(ngModel)]="nuevoUsuarioForm.rol">
            <option value="">Seleccionar rol...</option>
            <option *ngFor="let rol of roles" [value]="rol.nombre">{{ getRolDisplayName(rol.nombre) }}</option>
          </select>
        </div>
        
        <!-- Configuraci√≥n DEMO -->
        <div class="form-group" style="grid-column: 1 / -1;">
          <div class="demo-section">
            <label class="demo-checkbox">
              <input
                type="checkbox"
                [(ngModel)]="nuevoUsuarioForm.esDemo"
                (change)="onDemoToggleChange()"
              />
              <span>üéØ Crear como cuenta DEMO (acceso temporal con todas las funciones)</span>
            </label>
            
            <div class="demo-config" *ngIf="nuevoUsuarioForm.esDemo" style="margin-top: 15px; padding: 15px; background: rgba(255, 193, 7, 0.1); border-radius: 8px; border-left: 4px solid #ffc107;">
              <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label">
                  Duraci√≥n de la DEMO (en horas) *
                  <span class="form-hint">El usuario tendr√° acceso completo durante este tiempo</span>
                </label>
                <input
                  type="number"
                  class="form-input"
                  [(ngModel)]="nuevoUsuarioForm.horasDemo"
                  placeholder="Ej: 1, 2, 24, 48..."
                  min="1"
                  max="720"
                  style="max-width: 200px;"
                />
                <div class="demo-info" style="margin-top: 10px; font-size: 0.875rem; color: #ffc107;">
                  <strong>‚è±Ô∏è Tiempo configurado:</strong>
                  <span *ngIf="nuevoUsuarioForm.horasDemo > 0">
                    {{ nuevoUsuarioForm.horasDemo }} hora(s) 
                    <span style="color: #ccc;">({{ calcularFinDemo() }})</span>
                  </span>
                  <span *ngIf="!nuevoUsuarioForm.horasDemo || nuevoUsuarioForm.horasDemo <= 0" style="color: #f44336;">
                    Por favor, ingresa un n√∫mero v√°lido de horas
                  </span>
                </div>
              </div>
              
              <div class="demo-warning" style="margin-top: 15px; padding: 10px; background: rgba(255, 87, 34, 0.1); border-radius: 6px; border-left: 4px solid #ff5722; font-size: 0.875rem; color: #ff5722;">
                <strong>‚ö†Ô∏è Importante:</strong>
                <ul style="margin: 8px 0 0 20px; padding: 0;">
                  <li>Una vez que expire el tiempo configurado, el usuario no podr√° iniciar sesi√≥n</li>
                  <li>El rol DEMO tiene acceso completo a todas las funciones del sistema</li>
                  <li>Puedes extender el tiempo editando el usuario despu√©s de crearlo</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Contrase√±a *</label>
          <input
            type="password"
            class="form-input"
            [(ngModel)]="nuevoUsuarioForm.password"
            placeholder="M√≠nimo 6 caracteres"
          />
        </div>
      </div>

      <div class="password-requirements">
        <h4>Requisitos de contrase√±a:</h4>
        <ul>
          <li>M√≠nimo 6 caracteres</li>
          <li>Se recomienda usar una combinaci√≥n de letras y n√∫meros</li>
        </ul>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn--ghost" (click)="cerrarModalNuevoUsuario()">
        Cancelar
      </button>
      <button class="btn btn--primary" (click)="crearUsuario()" [disabled]="creandoUsuario || !nuevoUsuarioForm.username || !nuevoUsuarioForm.nombre || !nuevoUsuarioForm.apellidos || !nuevoUsuarioForm.rol || !nuevoUsuarioForm.password">
        <span *ngIf="creandoUsuario" class="btn__spinner"></span>
        <span *ngIf="!creandoUsuario">‚ûï Crear Usuario</span>
      </button>
    </div>
  </div>
</div>

<!-- MODAL: √âXITO AL GUARDAR CONFIGURACI√ìN -->
<div class="modal-overlay modal--exito modal--exito-configuracion" *ngIf="mostrarModalExitoConfiguracion" (click)="cerrarModalExitoConfiguracion()">
  <div class="modal-content modal-content--exito modal-content--exito-configuracion" (click)="$event.stopPropagation()">
    <div class="exito-configuracion">
      <!-- C√≠rculo de carga -->
      <div class="exito-configuracion__loader" *ngIf="guardandoConfiguracion">
        <div class="spinner spinner--green"></div>
      </div>
      
      <!-- Check de √©xito -->
      <div class="exito-configuracion__check" *ngIf="configuracionGuardadaCompletada">
        <svg class="checkmark checkmark--green" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" width="60" height="60">
          <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
          <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
        </svg>
      </div>
      
      <h3 class="exito-configuracion__title">Configuraci√≥n Guardada</h3>
      <p class="exito-configuracion__message" *ngIf="configuracionGuardadaCompletada">
        Los cambios se han guardado exitosamente
      </p>
      <p class="exito-configuracion__message" *ngIf="guardandoConfiguracion">
        Guardando configuraci√≥n...
      </p>
    </div>
  </div>
</div>

<!-- MODAL: √âXITO CREACI√ìN USUARIO -->
<div class="modal-overlay modal--exito" *ngIf="mostrarModalExitoCreacion" (click)="cerrarModalExitoCreacion()">
  <div class="modal-content modal-content--exito" (click)="$event.stopPropagation()">
    <div class="exito-creacion-usuario">
      <!-- C√≠rculo de carga -->
      <div class="exito-creacion-usuario__loader" *ngIf="creandoUsuarioProceso">
        <div class="spinner spinner--success"></div>
      </div>
      
      <!-- Check de √©xito -->
      <div class="exito-creacion-usuario__check" *ngIf="usuarioCreadoCompletado">
        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" width="50" height="50">
          <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
          <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
        </svg>
      </div>
      
      <h3 class="exito-creacion-usuario__title">Usuario creado exitosamente</h3>
      <p class="exito-creacion-usuario__message" *ngIf="usuarioCreadoCompletado">
        <span *ngIf="nuevoUsuarioForm.esDemo">
          El usuario DEMO ha sido creado correctamente. Expirar√° en {{ nuevoUsuarioForm.horasDemo }} hora(s).
        </span>
        <span *ngIf="!nuevoUsuarioForm.esDemo">
          El usuario ha sido creado correctamente.
        </span>
      </p>
      <p class="exito-creacion-usuario__message" *ngIf="creandoUsuarioProceso">
        Creando usuario...
      </p>
    </div>
  </div>
</div>